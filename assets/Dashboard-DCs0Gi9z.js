import{r as i,b as C,c as O,a as _,j as e}from"./index-Dt9TJAyj.js";const T=t=>`â‚±${Number(t||0).toLocaleString("en-PH",{maximumFractionDigits:0})}`,b=t=>Number(t||0).toLocaleString(),H=(t="")=>{const s=String(t).trim().split(/\s+/),l=s[0]?.[0]||"",a=s.length>1?s[s.length-1][0]:"";return(l+a).toUpperCase()||"XX"},S=t=>t.toLocaleTimeString("en-PH",{hour:"2-digit",minute:"2-digit",hour12:!0}),$=t=>{if(t<=0)return"00:00:00";const s=Math.floor(t/(1e3*60*60)),l=Math.floor(t%(1e3*60*60)/(1e3*60)),a=Math.floor(t%(1e3*60)/1e3);return`${s.toString().padStart(2,"0")}:${l.toString().padStart(2,"0")}:${a.toString().padStart(2,"0")}`},R=t=>t.toLocaleDateString("en-PH",{month:"short",day:"numeric",year:"numeric"}),U=t=>t.toLocaleTimeString("en-PH",{hour:"numeric",minute:"2-digit",hour12:!0}),z={name:"Maria Cruz",code:"C001",status:"ON DUTY"},A={collections:45250,payouts_tapal:16250,tellers:12,processed_payouts:8},F=()=>{const t=new Date,s=new Date(t.getFullYear(),t.getMonth(),t.getDate());return[{title:"Swertres",variant:"variant-a",draws:[{time:new Date(s.getTime()+840*60*1e3),result:t>=new Date(s.getTime()+840*60*1e3)?"1-2-3":null,status:t>=new Date(s.getTime()+840*60*1e3)?"completed":"upcoming"},{time:new Date(s.getTime()+1020*60*1e3),result:t>=new Date(s.getTime()+1020*60*1e3)?"4-5-6":null,status:t>=new Date(s.getTime()+1020*60*1e3)?"completed":"upcoming"},{time:new Date(s.getTime()+1260*60*1e3),result:t>=new Date(s.getTime()+1260*60*1e3)?"7-8-9":null,status:t>=new Date(s.getTime()+1260*60*1e3)?"completed":"upcoming"}]},{title:"Last 2",variant:"variant-b",draws:[{time:new Date(s.getTime()+900*60*1e3),result:t>=new Date(s.getTime()+900*60*1e3)?"12":null,status:t>=new Date(s.getTime()+900*60*1e3)?"completed":"upcoming"},{time:new Date(s.getTime()+1140*60*1e3),result:t>=new Date(s.getTime()+1140*60*1e3)?"34":null,status:t>=new Date(s.getTime()+1140*60*1e3)?"completed":"upcoming"}]},{title:"STL Pares",variant:"variant-c",draws:[{time:new Date(s.getTime()+10.5*60*60*1e3),result:t>=new Date(s.getTime()+10.5*60*60*1e3)?"01-15":null,status:t>=new Date(s.getTime()+10.5*60*60*1e3)?"completed":"upcoming"},{time:new Date(s.getTime()+960*60*1e3),result:t>=new Date(s.getTime()+960*60*1e3)?"03-21":null,status:t>=new Date(s.getTime()+960*60*1e3)?"completed":"upcoming"},{time:new Date(s.getTime()+1200*60*1e3),result:t>=new Date(s.getTime()+1200*60*1e3)?"07-19":null,status:t>=new Date(s.getTime()+1200*60*1e3)?"completed":"upcoming"}]}]};function X({collector:t=z,stats:s=A,schedule:l=F()}){const[a,d]=i.useState(new Date),[o,c]=i.useState(!1),[g,w]=i.useState(!1),[m,L]=i.useState(s),v=i.useRef(null),N=C(),x=O(),{user:h,logout:E,isAuthenticated:D,loading:f}=_(),u=h?{name:h.fullName||"Collector",code:h.id||"C001",status:"ON DUTY",email:h.email}:t;i.useEffect(()=>{!f&&!D&&N("/",{replace:!0})},[D,f,N]);const M=async()=>{if(!g)try{w(!0),c(!1),await E()}catch(n){console.error("Logout error:",n),w(!1)}};i.useEffect(()=>{const n=r=>{v.current&&!v.current.contains(r.target)&&c(!1)};return o&&document.addEventListener("mousedown",n),()=>{document.removeEventListener("mousedown",n)}},[o]),i.useEffect(()=>{const n=r=>{r.key==="Escape"&&o&&c(!1)};return document.addEventListener("keydown",n),()=>document.removeEventListener("keydown",n)},[o]),i.useEffect(()=>{const n=setInterval(()=>{d(new Date)},1e3);return()=>clearInterval(n)},[]),i.useEffect(()=>(document.body.classList.add("collector-bg"),()=>document.body.classList.remove("collector-bg")),[]),i.useEffect(()=>{const n=setInterval(()=>{L(r=>{const k=Math.floor(Math.random()*5e3),I=Math.floor(Math.random()*2e3);return{...r,collections:r.collections+k,payouts_tapal:r.payouts_tapal+I,processed_payouts:r.processed_payouts+(Math.random()>.7?1:0)}})},3e4);return()=>clearInterval(n)},[]);const P=i.useMemo(()=>H(u.name),[u.name]),y=()=>{c(n=>!n)};return f?e.jsx("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"100vh",fontSize:"1.25rem",color:"#6b7280"},children:"Loading..."}):e.jsxs("div",{className:"collector-container","aria-live":"polite",children:[e.jsxs("header",{className:"collector-header",children:[e.jsx("h1",{children:"ðŸ’° Collector Dashboard"}),e.jsxs("div",{className:"header-right",children:[e.jsxs("div",{ref:v,className:`user-info ${o?"menu-open":""}`,"aria-label":"Collector status",onClick:y,role:"button",tabIndex:0,onKeyDown:n=>{(n.key==="Enter"||n.key===" ")&&(n.preventDefault(),y())},children:[e.jsx("div",{className:"user-avatar","aria-hidden":"true",children:P}),e.jsxs("div",{className:"user-details",children:[e.jsx("div",{className:"user-name",children:u.name}),e.jsxs("div",{className:"user-role",children:["Collector #",u.code]})]}),e.jsx("div",{className:"status-badge",children:u.status}),e.jsx("span",{className:"profile-chevron","aria-hidden":"true"}),o&&e.jsx("div",{className:"collector-profile-menu",children:e.jsxs("button",{onClick:n=>{n.stopPropagation(),M()},disabled:g,type:"button",children:[e.jsx("span",{children:"ðŸšª"}),e.jsx("span",{children:g?"Logging out...":"Logout"})]})})]}),e.jsxs("div",{className:"datetime-pill",children:[R(a)," â€¢ ",U(a)]})]})]}),!x&&e.jsxs(e.Fragment,{children:[e.jsxs("section",{"aria-labelledby":"stats-title",children:[e.jsx("h2",{id:"stats-title",className:"sr-only",children:"Today's Collection Stats"}),e.jsxs("div",{className:"stats-grid",children:[e.jsx(p,{icon:"ðŸ’µ",value:T(m.collections),label:"Collections",live:!0}),e.jsx(p,{icon:"ðŸŽ¯",value:T(m.payouts_tapal),label:"Payouts / Tapal",live:!0}),e.jsx(p,{icon:"ðŸ‘¥",value:b(m.tellers),label:"Active Tellers"}),e.jsx(p,{icon:"âœ…",value:b(m.processed_payouts),label:"Processed Today"})]})]}),e.jsxs("main",{className:"bento-grid",children:[e.jsx(j,{to:"/collector/sales-collection",icon:"ðŸ’°",title:"Sales Collection",desc:"Collect remittances from tellers and update ledger records.",cta:"Collect Sales"}),e.jsx(j,{to:"/collector/payouts-tapal",icon:"ðŸŽ¯",title:"Payouts & Tapal",desc:"Process winner payouts or issue tapal for insufficient funds.",cta:"Process Payouts"}),e.jsx(j,{to:"/collector/reports",icon:"ðŸ“Š",title:"Reports",desc:"Generate remittance and combined payouts/tapal reports.",cta:"View Reports"}),e.jsxs("section",{className:"bento-card large","aria-labelledby":"schedule-title",children:[e.jsx("div",{className:"card-icon","aria-hidden":"true",children:"ðŸ“…"}),e.jsx("div",{className:"card-title",id:"schedule-title",children:"Today's Draw Schedule"}),e.jsx("div",{className:"card-description",children:"Live countdown and results tracking"}),e.jsx("div",{className:"schedule-grid",children:l.map((n,r)=>e.jsx(Y,{game:n,currentTime:a},r))})]})]})]}),x&&e.jsx("section",{className:"collector-outlet","aria-label":"Module Content",children:x})]})}function p({icon:t,value:s,label:l,live:a=!1}){return e.jsxs("div",{className:"stat-card","aria-live":a?"polite":void 0,children:[e.jsx("div",{className:"stat-icon","aria-hidden":"true",children:t}),e.jsx("div",{className:"stat-value",children:s}),e.jsx("div",{className:"stat-label",children:l})]})}function j({to:t,icon:s,title:l,desc:a,cta:d}){const o=C();return e.jsxs("button",{type:"button",className:"bento-card","aria-label":l,onClick:()=>o(t),onKeyDown:c=>{(c.key==="Enter"||c.key===" ")&&(c.preventDefault(),o(t))},style:{position:"relative",zIndex:2},children:[e.jsx("div",{className:"card-icon","aria-hidden":"true",children:s}),e.jsx("div",{className:"card-title",children:l}),e.jsx("div",{className:"card-description",children:a}),e.jsxs("span",{className:"card-cta","aria-hidden":"true",children:[d," â†’"]})]})}function Y({game:t,currentTime:s}){const l=t.draws.find(a=>a.status==="upcoming"&&a.time>s);return e.jsxs("div",{className:`schedule-card ${t.variant}`,children:[e.jsx("div",{className:"schedule-title",children:t.title}),l&&e.jsxs("div",{className:"schedule-countdown",children:[e.jsx("div",{className:"countdown-label",children:"Next Draw"}),e.jsx("div",{className:"countdown-time",children:S(l.time)}),e.jsx("div",{className:"countdown-timer",children:$(l.time-s)})]}),e.jsx("div",{className:"schedule-draws",children:t.draws.map((a,d)=>e.jsxs("div",{className:`schedule-draw ${a.status}`,children:[e.jsx("div",{className:"draw-time",children:S(a.time)}),a.status==="completed"&&a.result&&e.jsxs("div",{className:"draw-result",children:[e.jsx("span",{className:"result-label",children:"Result:"}),e.jsx("span",{className:"result-numbers",children:a.result})]}),a.status==="upcoming"&&e.jsx("div",{className:"draw-status",children:a===l?"Next":"Upcoming"})]},d))})]})}export{X as default};
