import{r as n,j as e,R as ne}from"./index-DiIR2jkv.js";import{r as je}from"./index-B7JEGhYb.js";const De=()=>{const u=n.useMemo(()=>({pares:["10:30 AM","4:00 PM","8:00 PM"],l2:["3:00 PM","7:00 PM"],l3:["2:00 PM","5:00 PM","9:00 PM"],sw3:["2:00 PM","5:00 PM","9:00 PM"]}),[]),x=n.useMemo(()=>({pares:"STL Pares",l2:"Last 2",l3:"Last 3",sw3:"Swer3"}),[]),v=n.useMemo(()=>({pares:700,l2:100,l3:100,sw3:100}),[]),f=15,_=60,M=n.useCallback(()=>{const s=new Date;return new Date(s.getTime()-s.getTimezoneOffset()*6e4).toISOString().split("T")[0]},[]),[m]=n.useState(M),[i,p]=n.useState(M),[y,X]=n.useState(""),[Q,S]=n.useState(""),[w,b]=n.useState(()=>{try{return JSON.parse(localStorage.getItem("DMX_RESULTS_V1")||"{}")}catch{return{}}}),[N,I]=n.useState(!1),[E,z]=n.useState(null),[q,B]=n.useState(""),[O,G]=n.useState(!1),[C,le]=n.useState(null),[J,re]=n.useState(""),[ce,oe]=n.useState({key:"idx",dir:"asc"}),A=n.useRef(null);n.useEffect(()=>{const s=setTimeout(()=>S(y),300);return()=>clearTimeout(s)},[y]),n.useEffect(()=>{const s=setTimeout(()=>{localStorage.setItem("DMX_RESULTS_V1",JSON.stringify(w))},500);return()=>clearTimeout(s)},[w]);const ie=n.useCallback(s=>new Date(s+"T00:00:00").toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"}),[]),U=n.useCallback(s=>{const a=/(\d{1,2}):(\d{2})\s*(AM|PM)/i.exec(String(s).trim());if(!a)return 0;let t=parseInt(a[1],10);const l=parseInt(a[2],10),r=a[3].toUpperCase();return r==="PM"&&t!==12&&(t+=12),r==="AM"&&t===12&&(t=0),t*60+l},[]),V=n.useCallback(()=>{const s=new Date;return s.getHours()*60+s.getMinutes()},[]),k=n.useCallback((s,a)=>Math.floor(Math.random()*(a-s+1))+s,[]),F=n.useCallback(s=>s[k(0,s.length-1)],[k]),de=n.useCallback(()=>"T"+Math.random().toString(36).slice(2,10).toUpperCase(),[]),me=n.useMemo(()=>Array.from({length:24},(s,a)=>`Teller ${a+1}`),[]),ue=n.useMemo(()=>Array.from({length:30},(s,a)=>`Outlet ${a+1}`),[]),P=n.useCallback((s,a,t)=>`${s}__${a}__${t}`,[]),g=n.useCallback((s,a,t)=>`DMX_WINNERS_V1__${s}__${a}__${t}`,[]),D=n.useCallback((s,a,t)=>`DMX_STATS_V1__${s}__${a}__${t}`,[]),T=n.useCallback((s,a,t)=>{const l=w[P(s,a,t)];return l?typeof l=="string"?{v:l,ts:null}:typeof l=="object"&&l.v!=null?l:null:null},[w,P]),he=n.useCallback((s,a,t,l)=>{const r=P(s,a,t);b(d=>{const c={...d};return l?c[r]={v:l,ts:Date.now()}:delete c[r],c})},[P]),xe=n.useCallback(s=>{if(s==="pares"){const a=String(k(1,40)).padStart(2,"0");let t=String(k(1,40)).padStart(2,"0");return t===a&&(t=String(parseInt(t,10)%40+1).padStart(2,"0")),`${a}.${t}`}return s==="l2"?String(k(0,99)).padStart(2,"0"):s==="l3"||s==="sw3"?String(k(0,999)).padStart(3,"0"):"—"},[k]),L=n.useCallback((s,a,t)=>{const l=k(12,36),r=[],d=v[s]??100,c=[1,2,5,10,20,50];for(let o=0;o<l;o++){const h=F(c);r.push({outlet:F(ue),teller:F(me),ticket:de(),result:t,bet_amount:h,prize:h*d,status:Math.random()>.75?"Pending":"Paid"})}return r},[k,F,de,v,ue,me]),R=n.useCallback((s,a,t)=>{if(!!(t&&t.v))return t.ts&&Date.now()>=t.ts+_*60*1e3?"locked":"published";if(s>m)return"upcoming";if(s===m){const r=U(a),d=Math.max(0,r-f);return V()>=d?"open":"upcoming"}return"open"},[m,U,V]),H=n.useCallback(s=>s!=="locked"&&s!=="upcoming",[]),Y=n.useCallback((s,a,t)=>{try{const l=JSON.parse(localStorage.getItem(g(s,a,t))||"[]"),r=l.reduce((d,c)=>d+(+c?.prize||0),0);return{count:l.length,payout:r}}catch{return{count:0,payout:0}}},[g]);n.useEffect(()=>{const s="DMX_DEMO_SEEDED_V1";if(localStorage.getItem(s)===m)return;const t={...w};let l=!1;Object.entries({pares:{schedules:u.pares},l2:{schedules:u.l2},l3:{schedules:u.l3},sw3:{schedules:u.sw3}}).forEach(([r,d])=>{(d.schedules||[]).forEach(c=>{const o=U(c);if(V()>=o-f){const h=P(m,r,c);if(!t[h]||!t[h].v){const j=xe(r);t[h]={v:j,ts:Date.now()-Math.floor(Math.random()*2e3)};const fe=L(r,c,j);localStorage.setItem(g(m,r,c),JSON.stringify(fe));const ae=Math.max(fe.length,120),ge=Math.max(ae+1,1200),ke=Math.floor(Math.random()*(ge-ae+1))+ae;localStorage.setItem(D(m,r,c),JSON.stringify({totalTickets:ke})),l=!0}}})}),l&&b(t),localStorage.setItem(s,m)},[m,u,U,V,P,xe,L,g,D]);const Z=n.useMemo(()=>({pares:{format:"01.02",help:"Enter two different numbers from 01-40, separated by a period (e.g., 05.23)",validate:s=>{const a=/^(\d{2})\.(\d{2})$/.exec(s);if(!a)return!1;const t=parseInt(a[1],10),l=parseInt(a[2],10);return!(t<1||t>40||l<1||l>40||t===l)}},l2:{format:"00",help:"Enter a 2-digit number from 00-99 (e.g., 05, 42, 99)",validate:s=>/^\d{2}$/.test(s)&&+s>=0&&+s<=99},l3:{format:"000",help:"Enter a 3-digit number from 000-999 (e.g., 005, 123, 999)",validate:s=>/^\d{3}$/.test(s)&&+s>=0&&+s<=999},sw3:{format:"000",help:"Enter a 3-digit number from 000-999 (e.g., 005, 123, 999)",validate:s=>/^\d{3}$/.test(s)&&+s>=0&&+s<=999}}),[]),K=n.useMemo(()=>{const s=["pares","l2","l3","sw3"];let a=0,t=0,l=0,r=0;return s.forEach(d=>{(u[d]||[]).forEach(c=>{a++;const o=T(i,d,c),h=R(i,c,o);if(h==="published"||h==="locked"){t++;const j=Y(i,d,c);l+=j.payout,r+=j.count}})}),{totalDraws:a,publishedDraws:t,totalPayout:l,totalWinners:r}},[i,u,T,R,Y]),be=n.useCallback((s,a)=>{G(!1);const t=T(i,s,a),l=R(i,a,t);if(!H(l)){alert(l==="locked"?"Editing is locked an hour after the result is saved.":"This draw is upcoming and not editable yet.");return}const r=Z[s]||Z.l2,d={name:x[s]||s,schedules:u[s],format:r.format,help:r.help,validate:r.validate};z({game:s,time:a,def:d,entry:t}),B(t?.v||""),I(!0)},[i,T,R,H,Z,x,u]),W=n.useCallback(()=>{I(!1),z(null),B("")},[]),ee=n.useCallback(s=>{if(s.preventDefault(),!E)return;const{game:a,time:t,def:l}=E,r=q.trim();if(r&&l&&typeof l.validate=="function"&&!l.validate(r)){alert(`Invalid format. ${l.help}`),A.current?.focus();return}if(he(i,a,t,r),r)try{const d=JSON.parse(localStorage.getItem(g(i,a,t))||"[]");if(!d||d.length===0){const c=L(a,t,r);localStorage.setItem(g(i,a,t),JSON.stringify(c));const o=Math.max(c.length,120),h=Math.max(o+1,1200),j=Math.floor(Math.random()*(h-o+1))+o;localStorage.setItem(D(i,a,t),JSON.stringify({totalTickets:j}))}}catch(d){console.error("Error during demo seed:",d)}else localStorage.setItem(g(i,a,t),"[]");W()},[E,q,i,he,g,L,D,W]),Ne=n.useCallback((s,a)=>{try{const t=g(i,s,a);let l=JSON.parse(localStorage.getItem(t)||"[]");const r=T(i,s,a)?.v||"—";!l.length&&r!=="—"&&(l=L(s,a,r),localStorage.setItem(t,JSON.stringify(l)));const d=v[s]??100;l=l.map((o,h)=>({...o,__i:h,bet_amount:o.bet_amount??(typeof o.bet=="number"?o.bet:1),prize:o.prize??(o.bet_amount||1)*d}));let c=null;try{c=JSON.parse(localStorage.getItem(D(i,s,a))||"null")}catch(o){console.error("Failed to parse stats from localStorage:",o)}if(!c){const o=Math.max(l.length,120),h=Math.max(o+1,1200);c={totalTickets:Math.floor(Math.random()*(h-o+1))+o},localStorage.setItem(D(i,s,a),JSON.stringify(c))}le({game:s,time:a,winners:l,stats:c,gameName:x[s]||s}),re(""),oe({key:"idx",dir:"asc"}),G(!0)}catch(t){console.error("Error opening winners drawer:",t)}},[i,g,T,L,v,D,x]),se=n.useCallback(()=>{G(!1),le(null)},[]),pe=n.useCallback((s,a)=>{const{key:t,dir:l}=a,r=(c,o)=>o==="idx"?c.__i??0:o==="prize"?+c.prize||0:o==="bet_amount"?+c.bet_amount||0:o==="status"?{Pending:0,Paid:1}[c.status]??2:String(c[o]??"").toLowerCase();if(t==="idx")return[...s].sort((c,o)=>(c.__i-o.__i)*(l==="asc"?1:-1));const d=l==="asc"?1:-1;return[...s].sort((c,o)=>{const h=r(c,t),j=r(o,t);return typeof h=="number"&&typeof j=="number"?(h-j)*d:String(h).localeCompare(String(j),"en",{numeric:!0,sensitivity:"base"})*d})},[]),ve=n.useCallback(s=>oe(a=>a.key===s?{key:s,dir:a.dir==="asc"?"desc":"asc"}:{key:s,dir:"asc"}),[]),$=n.useMemo(()=>{if(!C)return[];let s=C.winners;if(J){const a=J.toLowerCase();s=s.filter(t=>`${t.teller} ${t.ticket} ${t.bet_amount} ${t.status} ${t.prize}`.toLowerCase().includes(a))}return pe(s,ce)},[C,J,ce,pe]),ye=n.useMemo(()=>C?{totalTickets:C.stats?.totalTickets||C.winners.length,totalWinners:$.length,totalPayout:$.reduce((s,a)=>s+(+a.prize||0),0),paid:$.filter(s=>s.status==="Paid").reduce((s,a)=>s+(+a.prize||0),0),pending:$.filter(s=>s.status==="Pending").reduce((s,a)=>s+(+a.prize||0),0)}:null,[C,$]);n.useEffect(()=>(N||O?document.body.classList.add("dmx-lock","dmx-blur-bg"):document.body.classList.remove("dmx-lock","dmx-blur-bg"),()=>{document.body.classList.remove("dmx-lock","dmx-blur-bg")}),[N,O]),n.useEffect(()=>{N&&A.current&&setTimeout(()=>A.current?.focus(),120)},[N]),n.useEffect(()=>{const s=t=>{t.key==="Escape"&&(N?W():O&&se())},a=t=>{t.key==="Enter"&&N&&!t.shiftKey&&!t.ctrlKey&&(t.preventDefault(),ee(t))};return document.addEventListener("keydown",s),document.addEventListener("keydown",a),()=>{document.removeEventListener("keydown",s),document.removeEventListener("keydown",a)}},[N,O,W,se,ee]);const te=i===m?"today":i<m?"archive":"future",Se=te==="today"?"Today":te==="archive"?"Archive":"Future";return e.jsxs("div",{className:"dmx",children:[e.jsxs("div",{className:"dmx-header",children:[e.jsxs("div",{className:"dmx-header-content",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"dmx-title",children:"Draw Management"}),e.jsx("p",{className:"dmx-subtitle",children:"Manage lottery draws, results, and winner payouts"})]}),e.jsxs("div",{className:"dmx-header-actions",children:[e.jsx("input",{className:"dmx-date-input-header",type:"date",value:i,max:m,onChange:s=>p(s.target.value)}),e.jsxs("div",{className:`dmx-status-badge ${te}`,children:[e.jsx("span",{className:"dmx-status-dot"}),e.jsx("span",{children:Se})]})]})]}),e.jsx("div",{className:"dmx-status-bar",children:e.jsxs("div",{className:"dmx-stats-header",children:[e.jsxs("div",{className:"dmx-stat-item-header",children:[e.jsx("span",{className:"dmx-stat-label-header",children:"Total Draws"}),e.jsx("span",{className:"dmx-stat-value-header",children:K.totalDraws})]}),e.jsxs("div",{className:"dmx-stat-item-header",children:[e.jsx("span",{className:"dmx-stat-label-header",children:"Published"}),e.jsx("span",{className:"dmx-stat-value-header",children:K.publishedDraws})]}),e.jsxs("div",{className:"dmx-stat-item-header",children:[e.jsx("span",{className:"dmx-stat-label-header",children:"Total Winners"}),e.jsx("span",{className:"dmx-stat-value-header",children:K.totalWinners})]}),e.jsxs("div",{className:"dmx-stat-item-header",children:[e.jsx("span",{className:"dmx-stat-label-header",children:"Total Payout"}),e.jsxs("span",{className:"dmx-stat-value-header",children:["₱",K.totalPayout.toLocaleString()]})]})]})})]}),e.jsxs("div",{className:"dmx-card",children:[e.jsx("div",{className:"dmx-filters",children:e.jsxs("div",{className:"dmx-search-container",children:[e.jsx("input",{type:"text",className:"dmx-search-input",placeholder:"Search draws, times, results…",value:y,onChange:s=>X(s.target.value)}),e.jsx("div",{className:"dmx-search-icon",children:"🔍"})]})}),["pares","l2","l3","sw3"].map(s=>e.jsx(Me,{game:s,label:x[s],schedules:u[s],currentDate:i,fmtDatePretty:ie,getEntry:T,computeStatus:R,computeInlineCounts:Y,debouncedSearch:Q,canEdit:H,onOpenModal:be,onOpenWinners:Ne},s))]}),e.jsx(we,{open:N,data:E,input:q,setInput:B,inputRef:A,currentDate:i,fmtDatePretty:ie,onClose:W,onSubmit:ee}),e.jsx(Ce,{open:O,data:C,filteredWinners:$,winnerStats:ye,search:J,setSearch:re,onSort:ve,onClose:se})]})},Me=ne.memo(({game:u,label:x,schedules:v,currentDate:f,fmtDatePretty:_,getEntry:M,computeStatus:m,computeInlineCounts:i,debouncedSearch:p,canEdit:y,onOpenModal:X,onOpenWinners:Q})=>e.jsxs("div",{className:"dmx-game-section",children:[e.jsxs("div",{className:"dmx-game-header",children:[e.jsx("div",{className:"dmx-game-title",children:x}),e.jsxs("div",{className:"dmx-game-date",children:["Draw Date: ",e.jsx("span",{children:_(f)})]})]}),e.jsxs("table",{className:"dmx-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Time"}),e.jsx("th",{children:"Status"}),e.jsx("th",{children:"Results"}),e.jsx("th",{children:"Payout"}),e.jsx("th",{children:"Winners"}),e.jsx("th",{children:"Actions"})]})}),e.jsx("tbody",{children:v.map(S=>{const w=M(f,u,S),b=m(f,S,w),N=b==="published"||b==="locked",I=N?i(f,u,S):{count:0,payout:0},E=w?.v||"—",z=!p||`${S} ${b} ${E} ${x}`.toLowerCase().includes(p.toLowerCase());return e.jsxs("tr",{style:{display:z?"":"none"},children:[e.jsx("td",{className:"dmx-td-time",children:S}),e.jsx("td",{children:e.jsx("span",{className:`dmx-status-pill ${b}`,children:b.toUpperCase()})}),e.jsx("td",{children:e.jsx("span",{className:"dmx-result-value",children:E})}),e.jsx("td",{children:N?e.jsxs("span",{className:"dmx-inline-badge payout",children:["💸 ₱",I.payout.toLocaleString()]}):e.jsx("span",{children:"—"})}),e.jsx("td",{children:e.jsxs("button",{className:"dmx-winners-button",onClick:()=>Q(u,S),children:["👥 ",I.count]})}),e.jsx("td",{children:e.jsx("button",{className:"dmx-action-button",onClick:()=>X(u,S),disabled:!y(b),children:b==="published"?"Edit":b==="locked"?"View":"Enter"})})]},S)})})]})]})),we=ne.memo(({open:u,data:x,input:v,setInput:f,inputRef:_,currentDate:M,fmtDatePretty:m,onClose:i,onSubmit:p})=>!u||!x?null:je.createPortal(e.jsxs(e.Fragment,{children:[e.jsx("div",{className:`dmx-modal-overlay ${u?"active":""}`,onClick:i}),e.jsx("div",{className:"dmx-modal",children:e.jsxs("div",{className:"dmx-modal-panel",children:[e.jsxs("div",{className:"dmx-modal-header",children:[e.jsx("button",{className:"dmx-modal-close",onClick:i,children:"×"}),e.jsx("h3",{className:"dmx-modal-title",children:"Enter Draw Result"}),e.jsxs("div",{className:"dmx-modal-meta",children:[e.jsx("span",{className:"dmx-meta-tag",children:m(M)}),e.jsx("span",{className:"dmx-meta-tag",children:x.time}),e.jsx("span",{className:"dmx-meta-tag",children:x.def.name})]})]}),e.jsxs("div",{className:"dmx-modal-body",children:[e.jsx("label",{className:"dmx-form-label",children:"Enter Result"}),e.jsx("input",{ref:_,className:"dmx-form-input",type:"text",placeholder:x.def.format,value:v,onChange:y=>f(y.target.value),autoComplete:"off"}),e.jsx("div",{className:"dmx-form-help",children:x.def.help})]}),e.jsxs("div",{className:"dmx-modal-footer",children:[e.jsx("button",{className:"dmx-modal-button secondary",onClick:i,children:"Cancel"}),e.jsx("button",{className:"dmx-modal-button primary",onClick:p,children:"Save Result"})]})]})})]}),document.body)),Ce=ne.memo(({open:u,data:x,filteredWinners:v,winnerStats:f,search:_,setSearch:M,onSort:m,onClose:i})=>u?je.createPortal(e.jsxs(e.Fragment,{children:[e.jsx("div",{className:`dmx-winners-overlay ${u?"active":""}`,onClick:i}),e.jsxs("div",{className:`dmx-winners-drawer ${u?"active":""}`,children:[e.jsxs("div",{className:"dmx-winners-header",children:[e.jsxs("div",{className:"dmx-winners-header-title",children:[e.jsx("div",{className:"dmx-winners-title",children:"Winners Details"}),e.jsxs("div",{className:"dmx-winners-subtitle",children:[x?.gameName," • ",x?.time]})]}),e.jsxs("div",{className:"dmx-winners-header-actions",children:[e.jsx("button",{className:"dmx-winners-print",onClick:()=>window.print(),children:"Print"}),e.jsx("button",{className:"dmx-winners-close",onClick:i,children:"×"})]})]}),e.jsxs("div",{className:"dmx-winners-content",children:[e.jsxs("section",{className:"dmx-w-summary",children:[e.jsxs("div",{className:"dmx-summary-card",children:[e.jsx("div",{className:"dmx-summary-value",children:f?.totalTickets.toLocaleString()}),e.jsx("div",{className:"dmx-summary-label",children:"Total Tickets"})]}),e.jsxs("div",{className:"dmx-summary-card",children:[e.jsx("div",{className:"dmx-summary-value",children:f?.totalWinners.toLocaleString()}),e.jsx("div",{className:"dmx-summary-label",children:"Total Winners"})]}),e.jsxs("div",{className:"dmx-summary-card",children:[e.jsxs("div",{className:"dmx-summary-value",children:["₱",f?.totalPayout.toLocaleString()]}),e.jsx("div",{className:"dmx-summary-label",children:"Total Payout"})]})]}),e.jsx("section",{className:"dmx-winners-controls",children:e.jsx("input",{className:"dmx-wc-input",type:"search",placeholder:"Search all winners…",value:_,onChange:p=>M(p.target.value)})}),e.jsx("section",{children:e.jsxs("table",{className:"dmx-winners-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"sortable",onClick:()=>m("idx"),children:"#"}),e.jsx("th",{className:"sortable",onClick:()=>m("teller"),children:"Teller"}),e.jsx("th",{className:"sortable",onClick:()=>m("ticket"),children:"Ticket#"}),e.jsx("th",{className:"sortable",onClick:()=>m("bet_amount"),children:"Bet Amount"}),e.jsx("th",{className:"sortable money",onClick:()=>m("prize"),children:"Prize"}),e.jsx("th",{className:"sortable status",onClick:()=>m("status"),children:"Status"})]})}),e.jsx("tbody",{children:v.map((p,y)=>e.jsxs("tr",{children:[e.jsx("td",{children:y+1}),e.jsx("td",{children:p.teller}),e.jsx("td",{children:p.ticket}),e.jsxs("td",{className:"money",children:["₱",Number(p.bet_amount||0).toLocaleString()]}),e.jsxs("td",{className:"money",children:["₱",Number(p.prize||0).toLocaleString()]}),e.jsx("td",{className:"status",children:e.jsx("span",{className:`dmx-status-${(p.status||"Paid").toLowerCase()}`,children:p.status||"Paid"})})]},`${p.ticket}-${y}`))})]})}),e.jsxs("section",{className:"dmx-w-payouts",children:[e.jsxs("div",{className:"dmx-summary-card",children:[e.jsxs("div",{className:"dmx-summary-value",children:["₱",f?.paid.toLocaleString()]}),e.jsx("div",{className:"dmx-summary-label",children:"Paid Out"})]}),e.jsxs("div",{className:"dmx-summary-card",children:[e.jsxs("div",{className:"dmx-summary-value",children:["₱",f?.pending.toLocaleString()]}),e.jsx("div",{className:"dmx-summary-label",children:"Pending"})]})]})]})]})]}),document.body):null);export{De as default};
