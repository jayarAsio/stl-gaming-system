import{r as a,j as s,L as U}from"./index-DwPlwQmy.js";const Y=[{id:"T001",name:"Juan Dela Cruz",code:"TLR001",location:"Booth A1",totalSales:8420,totalWinners:15650,shortage:7230,ticketsSold:87,winningTickets:12,status:"needs_payout",lastPayout:"2025-01-14 03:30 PM",contactNumber:"09171234567"},{id:"T002",name:"Maria Santos",code:"TLR002",location:"Booth B2",totalSales:22150,totalWinners:18200,shortage:0,surplus:3950,ticketsSold:134,winningTickets:8,status:"surplus",lastPayout:"2025-01-13 11:45 AM",contactNumber:"09281234567"},{id:"T003",name:"Pedro Garcia",code:"TLR003",location:"Booth C3",totalSales:12750,totalWinners:28900,shortage:16150,ticketsSold:92,winningTickets:18,status:"needs_payout",lastPayout:"2025-01-15 09:15 AM",contactNumber:"09391234567"},{id:"T004",name:"Ana Reyes",code:"TLR004",location:"Booth D4",totalSales:31200,totalWinners:45600,shortage:14400,ticketsSold:156,winningTickets:22,status:"needs_payout",lastPayout:"2025-01-14 02:30 PM",contactNumber:"09401234567"},{id:"T005",name:"Carlos Lopez",code:"TLR005",location:"Booth E5",totalSales:18890,totalWinners:4250,shortage:0,surplus:14640,ticketsSold:73,winningTickets:3,status:"surplus",lastPayout:"2025-01-14 10:00 AM",contactNumber:"09511234567"}],G=[{id:"PAY001",tellerId:"T001",tellerName:"Juan Dela Cruz",amount:12500,type:"tapal",processedAt:"2025-01-15 01:30 PM",processedBy:"Collector C001",notes:"Emergency payout for major winner - jackpot prize",reason:"insufficient_funds"},{id:"PAY002",tellerId:"T003",tellerName:"Pedro Garcia",amount:8750,type:"tapal",processedAt:"2025-01-15 10:45 AM",processedBy:"Collector C001",notes:"Multiple winners exceeded daily sales",reason:"multiple_winners"}],q=()=>{const[u,L]=a.useState(Y),[p,_]=a.useState(G),[d,M]=a.useState(""),[j,B]=a.useState("needs_payout"),[o,w]=a.useState(null),[F,C]=a.useState(!1),[m,v]=a.useState(""),[N,g]=a.useState(""),[h,P]=a.useState(""),[b,k]=a.useState(!1),[f,A]=a.useState({show:!1,message:"",type:"success"}),[J,D]=a.useState(new Date);a.useEffect(()=>{const e=setInterval(()=>{D(new Date)},1e3);return()=>clearInterval(e)},[]),a.useEffect(()=>(document.body.classList.add("payout-tapal-bg"),()=>document.body.classList.remove("payout-tapal-bg")),[]);const l=new Intl.NumberFormat("en-PH",{style:"currency",currency:"PHP",maximumFractionDigits:2}),S=a.useCallback((e,t="success")=>{A({show:!0,message:e,type:t}),setTimeout(()=>A(n=>({...n,show:!1})),4e3)},[]),r=a.useMemo(()=>{const e=u.filter(i=>i.status==="needs_payout"),t=u.filter(i=>i.status==="surplus"),n=e.reduce((i,x)=>i+x.shortage,0),c=t.reduce((i,x)=>i+(x.surplus||0),0),O=p.reduce((i,x)=>i+x.amount,0);return{tellersNeedingPayout:e.length,tellersWithSurplus:t.length,totalShortage:n,totalSurplus:c,totalPayoutsToday:O,netPosition:c-n}},[u,p]),T=a.useMemo(()=>u.filter(e=>{const t=d===""||e.name.toLowerCase().includes(d.toLowerCase())||e.code.toLowerCase().includes(d.toLowerCase())||e.location.toLowerCase().includes(d.toLowerCase()),n=j==="all"||e.status===j;return t&&n}),[u,d,j]),E=a.useCallback(e=>{w(e),v(e.shortage.toString()),g(""),P("insufficient_funds"),C(!0)},[]),y=a.useCallback(()=>{C(!1),w(null),v(""),g(""),P("")},[]),R=a.useCallback(async()=>{if(!o||!m||!h)return;const e=parseFloat(m);if(isNaN(e)||e<=0){S("Please enter a valid payout amount","error");return}k(!0),setTimeout(()=>{const t={id:`PAY${Date.now().toString().slice(-6)}`,tellerId:o.id,tellerName:o.name,amount:e,type:"tapal",processedAt:new Date().toLocaleString("en-PH",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",hour12:!0}),processedBy:"Collector C001",notes:N||"Standard payout processing",reason:h};L(n=>n.map(c=>c.id===o.id?{...c,status:e>=c.shortage?"balanced":"needs_payout",shortage:Math.max(0,c.shortage-e),lastPayout:t.processedAt}:c)),_(n=>[t,...n]),k(!1),y(),S(`Payout processed: ${l.format(e)} to ${o.name}`,"success")},1200)},[o,m,h,N,l,S,y]),W=e=>{const t={needs_payout:{class:"status-needs-payout",text:"NEEDS PAYOUT",icon:"ðŸ’¸"},surplus:{class:"status-surplus",text:"HAS SURPLUS",icon:"ðŸ’°"},balanced:{class:"status-balanced",text:"BALANCED",icon:"âœ…"}};return t[e]||t.needs_payout},I=()=>s.jsxs("div",{className:"statistics-grid",children:[s.jsxs("div",{className:"stat-card",children:[s.jsx("div",{className:"stat-value",children:r.tellersNeedingPayout}),s.jsx("div",{className:"stat-label",children:"Need Payout"})]}),s.jsxs("div",{className:"stat-card shortage",children:[s.jsx("div",{className:"stat-value",children:l.format(r.totalShortage)}),s.jsx("div",{className:"stat-label",children:"Total Shortage"})]}),s.jsxs("div",{className:"stat-card surplus",children:[s.jsx("div",{className:"stat-value",children:l.format(r.totalSurplus)}),s.jsx("div",{className:"stat-label",children:"Total Surplus"})]}),s.jsxs("div",{className:"stat-card net",children:[s.jsx("div",{className:"stat-value",children:l.format(Math.abs(r.netPosition))}),s.jsx("div",{className:"stat-label",children:r.netPosition>=0?"Net Gain":"Net Loss"})]})]}),H=({teller:e})=>{const t=W(e.status),n=e.status==="needs_payout",c=e.shortage>0;return s.jsxs("article",{className:`teller-item ${e.status} ${c?"urgent":""}`,children:[s.jsxs("div",{className:"teller-header",children:[s.jsxs("div",{className:"teller-info",children:[s.jsx("div",{className:"teller-name",children:e.name}),s.jsxs("div",{className:"teller-meta",children:[s.jsx("span",{className:"teller-code",children:e.code}),s.jsx("span",{className:"teller-location",children:e.location})]})]}),s.jsxs("div",{className:`teller-status ${t.class}`,children:[s.jsx("span",{className:"status-icon",children:t.icon}),s.jsx("span",{className:"status-text",children:t.text})]})]}),s.jsxs("div",{className:"teller-stats",children:[s.jsxs("div",{className:"stat-row",children:[s.jsxs("div",{className:"stat",children:[s.jsx("div",{className:"stat-label",children:"Total Sales"}),s.jsx("div",{className:"stat-value",children:l.format(e.totalSales)})]}),s.jsxs("div",{className:"stat",children:[s.jsx("div",{className:"stat-label",children:"Winner Payouts"}),s.jsx("div",{className:"stat-value winners",children:l.format(e.totalWinners)})]})]}),s.jsxs("div",{className:"stat-row",children:[s.jsxs("div",{className:"stat",children:[s.jsx("div",{className:"stat-label",children:"Tickets Sold"}),s.jsx("div",{className:"stat-value",children:e.ticketsSold.toLocaleString()})]}),s.jsxs("div",{className:"stat",children:[s.jsx("div",{className:"stat-label",children:"Winning Tickets"}),s.jsx("div",{className:"stat-value winning-count",children:e.winningTickets.toLocaleString()})]})]}),c&&s.jsxs("div",{className:"shortage-row",children:[s.jsx("div",{className:"shortage-label",children:"Shortage Amount"}),s.jsx("div",{className:"shortage-amount",children:l.format(e.shortage)})]}),e.surplus>0&&s.jsxs("div",{className:"surplus-row",children:[s.jsx("div",{className:"surplus-label",children:"Surplus Amount"}),s.jsx("div",{className:"surplus-amount",children:l.format(e.surplus)})]})]}),s.jsxs("div",{className:"teller-footer",children:[s.jsxs("div",{className:"last-payout",children:["Last Payout: ",e.lastPayout]}),n&&s.jsxs("button",{className:"btn btn-payout urgent",onClick:()=>E(e),children:[s.jsx("span",{className:"btn-icon",children:"ðŸ’¸"}),"Process Tapal"]})]})]})},$=({payout:e})=>s.jsxs("article",{className:"history-item",children:[s.jsxs("div",{className:"history-header",children:[s.jsxs("div",{className:"history-info",children:[s.jsxs("div",{className:"history-id",children:["#",e.id]}),s.jsx("div",{className:"history-teller",children:e.tellerName}),s.jsx("div",{className:"history-type",children:e.type.toUpperCase()})]}),s.jsx("div",{className:"history-amount",children:l.format(e.amount)})]}),s.jsxs("div",{className:"history-details",children:[s.jsx("div",{className:"history-time",children:e.processedAt}),s.jsxs("div",{className:"history-processor",children:["by ",e.processedBy]})]}),s.jsxs("div",{className:"history-reason",children:["Reason: ",e.reason.replace(/_/g," ").toUpperCase()]}),e.notes&&s.jsx("div",{className:"history-notes",children:e.notes})]}),z=[{value:"insufficient_funds",label:"Insufficient Funds"},{value:"multiple_winners",label:"Multiple Winners"},{value:"jackpot_prize",label:"Jackpot Prize"},{value:"emergency_payout",label:"Emergency Payout"},{value:"system_error",label:"System Error"},{value:"other",label:"Other"}];return s.jsxs("div",{className:"container",children:[s.jsxs("header",{className:"header",children:[s.jsxs("div",{className:"header-content",children:[s.jsx("h1",{children:"Payout & Tapal"}),s.jsx("p",{className:"header-subtitle",children:"Process winner payouts or issue tapal for insufficient funds"})]}),s.jsxs(U,{to:"/collector",className:"back-btn","aria-label":"Back to Dashboard",children:[s.jsx("span",{"aria-hidden":"true",children:"â†"})," Back To Dashboard"]})]}),s.jsxs("section",{className:"card statistics-section",children:[s.jsxs("h2",{className:"section-title",children:[s.jsx("span",{className:"section-icon",children:"ðŸ“Š"}),"Payout Overview"]}),s.jsx(I,{}),s.jsxs("div",{className:"summary-details",children:[s.jsxs("div",{className:"summary-row",children:[s.jsx("span",{children:"Today's Payouts Issued"}),s.jsx("span",{className:"amount",children:l.format(r.totalPayoutsToday)})]}),s.jsxs("div",{className:"summary-row",children:[s.jsx("span",{children:"Net Company Position"}),s.jsxs("span",{className:`amount ${r.netPosition>=0?"positive":"negative"}`,children:[r.netPosition>=0?"+":"",l.format(r.netPosition)]})]})]})]}),s.jsxs("section",{className:"card controls-section",children:[s.jsxs("h2",{className:"section-title",children:[s.jsx("span",{className:"section-icon",children:"ðŸ”"}),"Search & Filter"]}),s.jsxs("div",{className:"controls-grid",children:[s.jsxs("div",{className:"control-group",children:[s.jsx("label",{htmlFor:"search",className:"control-label",children:"Search Tellers"}),s.jsx("input",{id:"search",type:"text",className:"control-input",placeholder:"Search by name, code, or location...",value:d,onChange:e=>M(e.target.value)})]}),s.jsxs("div",{className:"control-group",children:[s.jsx("label",{htmlFor:"status-filter",className:"control-label",children:"Filter by Status"}),s.jsxs("select",{id:"status-filter",className:"control-select",value:j,onChange:e=>B(e.target.value),children:[s.jsx("option",{value:"all",children:"All Statuses"}),s.jsx("option",{value:"needs_payout",children:"Needs Payout"}),s.jsx("option",{value:"surplus",children:"Has Surplus"}),s.jsx("option",{value:"balanced",children:"Balanced"})]})]})]})]}),s.jsxs("section",{className:"card tellers-section",children:[s.jsxs("h2",{className:"section-title",children:[s.jsx("span",{className:"section-icon",children:"ðŸ‘¥"}),"Tellers (",T.length,")"]}),T.length===0?s.jsxs("div",{className:"empty-state",children:[s.jsx("div",{className:"empty-icon",children:"ðŸ”"}),s.jsx("div",{className:"empty-title",children:"No Tellers Found"}),s.jsx("div",{className:"empty-text",children:"Try adjusting your search criteria or filters."})]}):s.jsx("div",{className:"tellers-grid",children:T.map(e=>s.jsx(H,{teller:e},e.id))})]}),s.jsxs("section",{className:"card history-section",children:[s.jsxs("h2",{className:"section-title",children:[s.jsx("span",{className:"section-icon",children:"ðŸ“‹"}),"Payout History"]}),p.length===0?s.jsxs("div",{className:"empty-state",children:[s.jsx("div",{className:"empty-icon",children:"ðŸ“‹"}),s.jsx("div",{className:"empty-title",children:"No Payouts Yet"}),s.jsx("div",{className:"empty-text",children:"Payout records will appear here after you process tapal payments."})]}):s.jsx("div",{className:"history-grid",children:p.map(e=>s.jsx($,{payout:e},e.id))})]}),F&&o&&s.jsx("div",{className:"modal-overlay",children:s.jsxs("div",{className:"modal",children:[s.jsxs("div",{className:"modal-header",children:[s.jsx("h3",{children:"Process Payout"}),s.jsx("button",{className:"modal-close",onClick:y,"aria-label":"Close modal",children:"Ã—"})]}),s.jsxs("div",{className:"modal-body",children:[s.jsxs("div",{className:"teller-summary",children:[s.jsxs("h4",{children:[o.name," (",o.code,")"]}),s.jsxs("div",{className:"summary-grid",children:[s.jsxs("div",{className:"summary-item",children:[s.jsx("span",{children:"Total Sales"}),s.jsx("span",{children:l.format(o.totalSales)})]}),s.jsxs("div",{className:"summary-item",children:[s.jsx("span",{children:"Winner Payouts"}),s.jsx("span",{children:l.format(o.totalWinners)})]}),s.jsxs("div",{className:"summary-item shortage-highlight",children:[s.jsx("span",{children:"Shortage Amount"}),s.jsx("span",{className:"highlight",children:l.format(o.shortage)})]})]})]}),s.jsxs("div",{className:"form-group",children:[s.jsx("label",{htmlFor:"payout-reason",className:"form-label",children:"Payout Reason"}),s.jsxs("select",{id:"payout-reason",className:"form-select",value:h,onChange:e=>P(e.target.value),children:[s.jsx("option",{value:"",children:"Select reason..."}),z.map(e=>s.jsx("option",{value:e.value,children:e.label},e.value))]})]}),s.jsxs("div",{className:"form-group",children:[s.jsx("label",{htmlFor:"payout-amount",className:"form-label",children:"Payout Amount"}),s.jsx("input",{id:"payout-amount",type:"number",step:"0.01",min:"0",className:"form-input",value:m,onChange:e=>v(e.target.value)}),s.jsx("div",{className:"form-help",children:"Enter the amount to advance to the teller for winner payments."})]}),s.jsxs("div",{className:"form-group",children:[s.jsx("label",{htmlFor:"payout-notes",className:"form-label",children:"Notes (Optional)"}),s.jsx("textarea",{id:"payout-notes",className:"form-textarea",placeholder:"Add any notes about this payout...",value:N,onChange:e=>g(e.target.value),maxLength:500}),s.jsxs("div",{className:"form-help",children:[N.length,"/500 characters"]})]})]}),s.jsxs("div",{className:"modal-footer",children:[s.jsx("button",{className:"btn btn-secondary",onClick:y,disabled:b,children:"Cancel"}),s.jsx("button",{className:"btn btn-primary",onClick:R,disabled:b||!m||!h,children:b?s.jsxs(s.Fragment,{children:[s.jsx("span",{className:"spinner"}),"Processing..."]}):s.jsxs(s.Fragment,{children:[s.jsx("span",{children:"ðŸ’¸"}),"Process Payout"]})})]})]})}),f.show&&s.jsx("div",{className:`toast show ${f.type}`,children:f.message})]})};export{q as default};
