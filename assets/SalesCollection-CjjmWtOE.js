import{r as o,j as e,L as q}from"./index-BNB87u39.js";import{r as K}from"./index-BoSsTtpQ.js";const X=[{id:"T001",name:"Juan Dela Cruz",code:"TLR001",location:"Booth A1",totalSales:25420,totalWinners:8650,surplus:16770,commission:1271,netCollection:15499,originalNetCollection:15499,collectedAmount:0,ticketsSold:87,winningTickets:5,status:"ready_collection",lastCollection:"2025-01-14 09:30 AM",contactNumber:"09171234567"},{id:"T002",name:"Maria Santos",code:"TLR002",location:"Booth B2",totalSales:18150,totalWinners:12200,surplus:5950,commission:907.5,netCollection:5042.5,originalNetCollection:5042.5,collectedAmount:5042.5,ticketsSold:134,winningTickets:8,status:"collected",lastCollection:"2025-01-15 12:30 PM",contactNumber:"09281234567"},{id:"T003",name:"Pedro Garcia",code:"TLR003",location:"Booth C3",totalSales:32750,totalWinners:18900,surplus:13850,commission:1637.5,netCollection:12212.5,originalNetCollection:12212.5,collectedAmount:0,ticketsSold:92,winningTickets:12,status:"ready_collection",lastCollection:"2025-01-14 10:15 AM",contactNumber:"09391234567"},{id:"T004",name:"Ana Reyes",code:"TLR004",location:"Booth D4",totalSales:28200,totalWinners:15600,surplus:12600,commission:1410,netCollection:11190,originalNetCollection:11190,collectedAmount:0,ticketsSold:156,winningTickets:18,status:"ready_collection",lastCollection:"2025-01-14 07:30 AM",contactNumber:"09401234567"},{id:"T005",name:"Carlos Lopez",code:"TLR005",location:"Booth E5",totalSales:22890,totalWinners:4250,surplus:18640,commission:1144.5,netCollection:17495.5,originalNetCollection:17495.5,collectedAmount:17495.5,ticketsSold:73,winningTickets:3,status:"collected",lastCollection:"2025-01-15 11:00 AM",contactNumber:"09511234567"},{id:"T006",name:"Rosa Martinez",code:"TLR006",location:"Booth F6",totalSales:15600,totalWinners:15600,surplus:0,commission:780,netCollection:0,originalNetCollection:0,collectedAmount:0,ticketsSold:45,winningTickets:12,status:"balanced",lastCollection:"2025-01-13 02:15 PM",contactNumber:"09621234567"},{id:"T007",name:"Miguel Fernandez",code:"TLR007",location:"Booth G7",totalSales:2850,totalWinners:0,surplus:2850,commission:142.5,netCollection:2707.5,originalNetCollection:2707.5,collectedAmount:0,ticketsSold:12,winningTickets:0,status:"ready_collection",lastCollection:"2025-01-12 04:30 PM",contactNumber:"09731234567"},{id:"T008",name:"Elena Gonzalez",code:"TLR008",location:"Booth H8",totalSales:0,totalWinners:0,surplus:0,commission:0,netCollection:0,originalNetCollection:0,collectedAmount:0,ticketsSold:0,winningTickets:0,status:"no_activity",lastCollection:"2025-01-10 11:45 AM",contactNumber:"09841234567"},{id:"T009",name:"Lisa Santos",code:"TLR009",location:"Booth I9",totalSales:1250,totalWinners:850,surplus:400,commission:62.5,netCollection:337.5,originalNetCollection:337.5,collectedAmount:0,ticketsSold:8,winningTickets:2,status:"ready_collection",lastCollection:"2025-01-13 09:10 AM",contactNumber:"09061234567"}],Z=[{id:"COL001",tellerId:"T002",tellerName:"Maria Santos",surplusAmount:5950,commissionDeducted:907.5,netCollected:5042.5,collectedAt:"2025-01-15 12:30 PM",collectedBy:"Collector C001",notes:"Surplus collection after winner payouts - verified cash count"},{id:"COL002",tellerId:"T005",tellerName:"Carlos Lopez",surplusAmount:18640,commissionDeducted:1144.5,netCollected:17495.5,collectedAt:"2025-01-15 12:45 PM",collectedBy:"Collector C001",notes:"Large surplus collection - minimal winners today"}],te=()=>{const[r,F]=o.useState(X),[P,D]=o.useState(Z),[h,I]=o.useState(""),[y,H]=o.useState("ready_collection"),[t,T]=o.useState(null),[w,A]=o.useState(!1),[j,g]=o.useState(""),[C,b]=o.useState(""),[k,_]=o.useState(!1),[L,W]=o.useState({show:!1,message:"",type:"success"}),[u,M]=o.useState(!1),[f,B]=o.useState(null);o.useEffect(()=>(document.body.classList.add("sales-collection-bg"),()=>document.body.classList.remove("sales-collection-bg")),[]),o.useEffect(()=>{if(w){const s=document.documentElement.style.overflow,l=document.body.style.overflow;return document.documentElement.style.overflow="hidden",document.body.style.overflow="hidden",()=>{document.documentElement.style.overflow=s,document.body.style.overflow=l}}},[w]);const a=o.useMemo(()=>new Intl.NumberFormat("en-PH",{style:"currency",currency:"PHP",maximumFractionDigits:2}),[]),x=o.useCallback((s,l="success")=>{W({show:!0,message:s,type:l}),setTimeout(()=>W(c=>({...c,show:!1})),4e3)},[]),S=o.useMemo(()=>{const s=r.filter(i=>i.status==="ready_collection"),l=r.filter(i=>i.status==="collected"),c=r.filter(i=>i.status==="balanced"),d=r.filter(i=>i.status==="no_activity"),n=r.reduce((i,m)=>i+m.surplus,0),N=r.reduce((i,m)=>i+m.commission,0),p=r.reduce((i,m)=>i+m.originalNetCollection,0),R=r.reduce((i,m)=>i+m.collectedAmount,0),V=s.reduce((i,m)=>i+m.netCollection,0);return{totalTellers:r.length,readyCount:s.length,collectedCount:l.length,balancedCount:c.length,noActivityCount:d.length,totalSurplus:n,totalCommission:N,totalNetCollection:p,collectedAmount:R,pendingAmount:V,collectionRate:r.length>0?(l.length/r.length*100).toFixed(1):0}},[r]),E=o.useMemo(()=>r.filter(s=>{const l=h===""||s.name.toLowerCase().includes(h.toLowerCase())||s.code.toLowerCase().includes(h.toLowerCase())||s.location.toLowerCase().includes(h.toLowerCase()),c=y==="all"||s.status===y;return l&&c}),[r,h,y]),$=o.useCallback(s=>{T(s),g(s.netCollection.toString()),b(""),M(!1),B(null),A(!0)},[]),O=o.useCallback(s=>{const l=r.find(c=>c.id===s.tellerId);l&&(T(l),g(s.netCollected.toString()),b(s.notes||""),M(!0),B(s),A(!0))},[r]),v=o.useCallback(()=>{A(!1),T(null),g(""),b(""),M(!1),B(null)},[]),z=o.useCallback(async()=>{if(!t||!j)return;const s=parseFloat(j);if(isNaN(s)||s<=0){x("Please enter a valid collection amount","error");return}if(s>t.netCollection){x("Collection amount cannot exceed net collection","error");return}_(!0),setTimeout(()=>{if(u&&f){const l=f.netCollected,c=s-l;D(d=>d.map(n=>n.id===f.id?{...n,netCollected:s,notes:C||n.notes,collectedAt:new Date().toLocaleString("en-PH",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",hour12:!0})+" (Edited)"}:n)),F(d=>d.map(n=>{if(n.id===t.id){const N=n.netCollection-c,p=n.collectedAmount+c,R=N<=0?"collected":"ready_collection";return{...n,netCollection:N,collectedAmount:p,status:R,lastCollection:new Date().toLocaleString("en-PH",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",hour12:!0})}}return n})),x(`Collection updated: ${a.format(s)} from ${t.name}`,"success")}else{const l={id:`COL${Date.now().toString().slice(-6)}`,tellerId:t.id,tellerName:t.name,surplusAmount:t.surplus,commissionDeducted:t.commission,netCollected:s,collectedAt:new Date().toLocaleString("en-PH",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",hour12:!0}),collectedBy:"Collector C001",notes:C||"Surplus collection after winner payouts"};if(D(c=>[l,...c]),F(c=>c.map(d=>{if(d.id===t.id){const n=d.netCollection-s,N=d.collectedAmount+s,p=n<=0?"collected":"ready_collection";return{...d,netCollection:n,collectedAmount:N,status:p,lastCollection:l.collectedAt}}return d})),s<t.netCollection){const c=t.netCollection-s;x(`Partial collection: ${a.format(s)} collected. Remaining balance: ${a.format(c)}`,"success")}else x(`Full surplus collected: ${a.format(s)} from ${t.name}`,"success")}_(!1),v()},1200)},[t,j,C,a,x,v,u,f]),G=s=>{const l={ready_collection:{class:"status-ready",text:"READY FOR COLLECTION",icon:"💰"},collected:{class:"status-collected",text:"COLLECTED",icon:"✅"},balanced:{class:"status-balanced",text:"BALANCED",icon:"⚖️"},no_activity:{class:"status-no-activity",text:"NO ACTIVITY",icon:"🚫"}};return l[s]||l.ready_collection},Y=()=>e.jsxs("div",{className:"statistics-grid",children:[e.jsxs("div",{className:"stat-card",children:[e.jsx("div",{className:"stat-value",children:S.totalTellers}),e.jsx("div",{className:"stat-label",children:"Total Tellers"})]}),e.jsxs("div",{className:"stat-card pending",children:[e.jsx("div",{className:"stat-value",children:S.readyCount}),e.jsx("div",{className:"stat-label",children:"Ready Collection"})]}),e.jsxs("div",{className:"stat-card collected",children:[e.jsx("div",{className:"stat-value",children:S.collectedCount}),e.jsx("div",{className:"stat-label",children:"Collected Today"})]}),e.jsxs("div",{className:"stat-card rate",children:[e.jsxs("div",{className:"stat-value",children:[S.collectionRate,"%"]}),e.jsx("div",{className:"stat-label",children:"Collection Rate"})]})]}),Q=({teller:s})=>{const l=G(s.status),c=s.status==="ready_collection"&&s.netCollection>0,d=s.surplus>2e4,n=s.collectedAmount>0&&s.netCollection>0;return e.jsxs("article",{className:`teller-item ${s.status} ${d?"high-value":""}`,children:[e.jsxs("div",{className:"teller-header",children:[e.jsxs("div",{className:"teller-info",children:[e.jsx("div",{className:"teller-name",children:s.name}),e.jsxs("div",{className:"teller-meta",children:[e.jsx("span",{className:"teller-code",children:s.code}),e.jsx("span",{className:"teller-location",children:s.location})]})]}),e.jsxs("div",{className:`teller-status ${l.class}`,children:[e.jsx("span",{className:"status-icon",children:l.icon}),e.jsx("span",{className:"status-text",children:l.text})]})]}),e.jsxs("div",{className:"teller-stats",children:[e.jsxs("div",{className:"stat-row",children:[e.jsxs("div",{className:"stat",children:[e.jsx("div",{className:"stat-label",children:"Total Sales"}),e.jsx("div",{className:"stat-value",children:a.format(s.totalSales)})]}),e.jsxs("div",{className:"stat",children:[e.jsx("div",{className:"stat-label",children:"Winner Payouts"}),e.jsx("div",{className:"stat-value winners",children:a.format(s.totalWinners)})]})]}),e.jsxs("div",{className:"stat-row",children:[e.jsxs("div",{className:"stat",children:[e.jsx("div",{className:"stat-label",children:"Tickets Sold"}),e.jsx("div",{className:"stat-value",children:s.ticketsSold.toLocaleString()})]}),e.jsxs("div",{className:"stat",children:[e.jsx("div",{className:"stat-label",children:"Winning Tickets"}),e.jsx("div",{className:"stat-value winning-count",children:s.winningTickets.toLocaleString()})]})]}),(c||s.status==="collected"||n)&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"stat-row",children:[e.jsxs("div",{className:"stat",children:[e.jsx("div",{className:"stat-label",children:"Gross Surplus"}),e.jsx("div",{className:"stat-value surplus",children:a.format(s.surplus)})]}),e.jsxs("div",{className:"stat",children:[e.jsx("div",{className:"stat-label",children:"Commission"}),e.jsx("div",{className:"stat-value commission",children:a.format(s.commission)})]})]}),s.collectedAmount>0&&e.jsxs("div",{className:"collection-row collected-row",children:[e.jsx("div",{className:"collection-label",children:"Amount Collected"}),e.jsx("div",{className:"collection-amount collected",children:a.format(s.collectedAmount)})]}),s.netCollection>0&&e.jsxs("div",{className:"collection-row",children:[e.jsx("div",{className:"collection-label",children:n?"Remaining Balance":"Net Collection Amount"}),e.jsx("div",{className:"collection-amount",children:a.format(s.netCollection)})]})]})]}),e.jsxs("div",{className:"teller-footer",children:[e.jsxs("div",{className:"last-collection",children:["Last Collection: ",s.lastCollection]}),c&&e.jsxs("button",{className:`btn btn-collect ${d?"high-value":""}`,onClick:()=>$(s),children:[e.jsx("span",{className:"btn-icon",children:"💰"}),n?"Collect Remaining":"Collect Surplus"]})]})]})},U=({collection:s})=>e.jsxs("article",{className:"history-item",children:[e.jsxs("div",{className:"history-header",children:[e.jsxs("div",{className:"history-info",children:[e.jsxs("div",{className:"history-id",children:["#",s.id]}),e.jsx("div",{className:"history-teller",children:s.tellerName})]}),e.jsx("div",{className:"history-amount",children:a.format(s.netCollected)})]}),e.jsxs("div",{className:"history-breakdown",children:[e.jsxs("div",{className:"breakdown-item",children:[e.jsx("span",{children:"Gross Surplus:"}),e.jsx("span",{children:a.format(s.surplusAmount)})]}),e.jsxs("div",{className:"breakdown-item",children:[e.jsx("span",{children:"Commission Deducted:"}),e.jsxs("span",{className:"commission",children:["-",a.format(s.commissionDeducted)]})]}),e.jsxs("div",{className:"breakdown-item total",children:[e.jsx("span",{children:"Net Collected:"}),e.jsx("span",{children:a.format(s.netCollected)})]})]}),e.jsxs("div",{className:"history-details",children:[e.jsx("div",{className:"history-time",children:s.collectedAt}),e.jsxs("div",{className:"history-collector",children:["by ",s.collectedBy]})]}),s.notes&&e.jsx("div",{className:"history-notes",children:s.notes}),e.jsx("div",{className:"history-actions",children:e.jsxs("button",{className:"btn btn-edit",onClick:()=>O(s),children:[e.jsx("span",{children:"✏️"}),"Edit Collection"]})})]}),J=({children:s})=>typeof document>"u"?null:K.createPortal(s,document.body);return e.jsxs("div",{className:"container",children:[e.jsxs("header",{className:"header",children:[e.jsxs("div",{className:"header-content",children:[e.jsx("h1",{children:"Sales Collection"}),e.jsx("p",{className:"header-subtitle",children:"Collect remittances from tellers and update ledger records"})]}),e.jsxs(q,{to:"/collector",className:"back-btn","aria-label":"Back to Dashboard",children:[e.jsx("span",{"aria-hidden":"true",children:"←"})," Back To Dashboard"]})]}),e.jsxs("section",{className:"card statistics-section",children:[e.jsxs("h2",{className:"section-title",children:[e.jsx("span",{className:"section-icon",children:"📊"}),"Collection Summary"]}),e.jsx(Y,{})]}),e.jsxs("section",{className:"card controls-section",children:[e.jsxs("h2",{className:"section-title",children:[e.jsx("span",{className:"section-icon",children:"🔍"}),"Search & Filter"]}),e.jsxs("div",{className:"controls-grid",children:[e.jsxs("div",{className:"control-group",children:[e.jsx("label",{htmlFor:"search",className:"control-label",children:"Search Tellers"}),e.jsx("input",{id:"search",type:"text",className:"control-input",placeholder:"Search by name, code, or location...",value:h,onChange:s=>I(s.target.value)})]}),e.jsxs("div",{className:"control-group",children:[e.jsx("label",{htmlFor:"status-filter",className:"control-label",children:"Filter by Status"}),e.jsxs("select",{id:"status-filter",className:"control-select",value:y,onChange:s=>H(s.target.value),children:[e.jsx("option",{value:"all",children:"All Statuses"}),e.jsx("option",{value:"ready_collection",children:"Ready for Collection"}),e.jsx("option",{value:"collected",children:"Collected"}),e.jsx("option",{value:"balanced",children:"Balanced"}),e.jsx("option",{value:"no_activity",children:"No Activity"})]})]})]})]}),e.jsxs("section",{className:"card tellers-section",children:[e.jsxs("h2",{className:"section-title",children:[e.jsx("span",{className:"section-icon",children:"👥"}),"Tellers with Surplus (",E.length,")"]}),E.length===0?e.jsxs("div",{className:"empty-state",children:[e.jsx("div",{className:"empty-icon",children:"🔍"}),e.jsx("div",{className:"empty-title",children:"No Tellers Found"}),e.jsx("div",{className:"empty-text",children:"Try adjusting your search criteria or filters."})]}):e.jsx("div",{className:"tellers-grid",children:E.map(s=>e.jsx(Q,{teller:s},s.id))})]}),e.jsxs("section",{className:"card history-section",children:[e.jsxs("h2",{className:"section-title",children:[e.jsx("span",{className:"section-icon",children:"📋"}),"Collection History"]}),P.length===0?e.jsxs("div",{className:"empty-state",children:[e.jsx("div",{className:"empty-icon",children:"📋"}),e.jsx("div",{className:"empty-title",children:"No Collections Yet"}),e.jsx("div",{className:"empty-text",children:"Collection records will appear here after you collect surplus amounts."})]}):e.jsx("div",{className:"history-grid",children:P.map(s=>e.jsx(U,{collection:s},s.id))})]}),w&&t&&e.jsx(J,{children:e.jsx("div",{className:"modal-overlay",role:"dialog","aria-modal":"true","aria-labelledby":"collection-modal-title",onClick:v,children:e.jsxs("div",{className:"modal",onClick:s=>s.stopPropagation(),children:[e.jsxs("div",{className:"modal-header",children:[e.jsx("h3",{id:"collection-modal-title",children:u?"Edit Collection":"Collect Surplus"}),e.jsx("button",{className:"modal-close",onClick:v,"aria-label":"Close modal",children:"×"})]}),e.jsxs("div",{className:"modal-body",children:[e.jsxs("div",{className:"teller-summary",children:[e.jsxs("h4",{children:[t.name," (",t.code,")"]}),e.jsxs("div",{className:"summary-grid",children:[e.jsxs("div",{className:"summary-item",children:[e.jsx("span",{children:"Total Sales"}),e.jsx("span",{children:a.format(t.totalSales)})]}),e.jsxs("div",{className:"summary-item",children:[e.jsx("span",{children:"Winner Payouts"}),e.jsx("span",{children:a.format(t.totalWinners)})]}),e.jsxs("div",{className:"summary-item",children:[e.jsx("span",{children:"Gross Surplus"}),e.jsx("span",{className:"surplus",children:a.format(t.surplus)})]}),e.jsxs("div",{className:"summary-item",children:[e.jsx("span",{children:"Commission (5%)"}),e.jsxs("span",{className:"commission",children:["-",a.format(t.commission)]})]}),t.collectedAmount>0&&e.jsxs("div",{className:"summary-item",children:[e.jsx("span",{children:"Already Collected"}),e.jsx("span",{className:"collected-highlight",children:a.format(t.collectedAmount)})]}),e.jsxs("div",{className:"summary-item",children:[e.jsx("span",{children:u?"Current Balance":t.collectedAmount>0?"Remaining Balance":"Net Collection"}),e.jsx("span",{className:"highlight",children:a.format(t.netCollection)})]})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"collection-amount",className:"form-label",children:"Collection Amount"}),e.jsx("input",{id:"collection-amount",type:"number",step:"0.01",min:"0",max:t.netCollection,className:"form-input",value:j,onChange:s=>g(s.target.value),autoFocus:!0}),e.jsx("div",{className:"form-help",children:u?"Update the collection amount. This will adjust the teller's balance accordingly.":"Enter the actual surplus amount collected. Can be partial or full amount."})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"collection-notes",className:"form-label",children:"Notes (Optional)"}),e.jsx("textarea",{id:"collection-notes",className:"form-textarea",placeholder:"Add any notes about this collection...",value:C,onChange:s=>b(s.target.value),maxLength:500}),e.jsxs("div",{className:"form-help",children:[C.length,"/500 characters"]})]})]}),e.jsxs("div",{className:"modal-footer",children:[e.jsx("button",{className:"btn btn-secondary",onClick:v,disabled:k,children:"Cancel"}),e.jsx("button",{className:"btn btn-primary",onClick:z,disabled:k||!j,children:k?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"spinner"}),"Processing..."]}):e.jsxs(e.Fragment,{children:[e.jsx("span",{children:u?"✏️":"💰"}),u?"Update Collection":"Complete Collection"]})})]})]})})}),L.show&&e.jsx("div",{className:`toast show ${L.type}`,children:L.message})]})};export{te as default};
