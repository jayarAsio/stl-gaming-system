import{r as d,j as t}from"./index-DwPlwQmy.js";import{r as ne}from"./index-kye1c0wU.js";const we=()=>{const N={pares:["10:30 AM","4:00 PM","8:00 PM"],l2:["3:00 PM","7:00 PM"],l3:["2:00 PM","5:00 PM","9:00 PM"],sw3:["2:00 PM","5:00 PM","9:00 PM"]},_={pares:"STL Pares",l2:"Last 2",l3:"Last 3",sw3:"Swer3"},A={pares:700,l2:100,l3:100,sw3:100},J=15,le=60,F=()=>{const e=new Date;return new Date(e.getTime()-e.getTimezoneOffset()*6e4).toISOString().split("T")[0]},[m]=d.useState(F),[o,re]=d.useState(F),[E,ce]=d.useState(""),[v,U]=d.useState(()=>{try{return JSON.parse(localStorage.getItem("DMX_RESULTS_V1")||"{}")}catch{return{}}}),[h,V]=d.useState(!1),[p,K]=d.useState(null),[X,L]=d.useState(""),[f,T]=d.useState(!1),[j,Q]=d.useState(null),[P,q]=d.useState(""),[ie,B]=d.useState({key:"idx",dir:"asc"}),D=d.useRef(null),H=e=>new Date(e+"T00:00:00").toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"}),G=e=>{const s=/(\d{1,2}):(\d{2})\s*(AM|PM)/i.exec(String(e).trim());if(!s)return 0;let a=parseInt(s[1],10);const n=parseInt(s[2],10),l=s[3].toUpperCase();return l==="PM"&&a!==12&&(a+=12),l==="AM"&&a===12&&(a=0),a*60+n},Y=()=>{const e=new Date;return e.getHours()*60+e.getMinutes()},S=(e,s)=>Math.floor(Math.random()*(s-e+1))+e,C=e=>e[S(0,e.length-1)],oe=()=>"T"+Math.random().toString(36).slice(2,10).toUpperCase(),de=Array.from({length:24},(e,s)=>`Teller ${s+1}`),ue=Array.from({length:30},(e,s)=>`Outlet ${s+1}`),$=(e,s,a)=>`${e}__${s}__${a}`,g=(e,s,a)=>`DMX_WINNERS_V1__${e}__${s}__${a}`,k=(e,s,a)=>`DMX_STATS_V1__${e}__${s}__${a}`,I=d.useCallback((e,s,a)=>{const n=v[$(e,s,a)];return n?typeof n=="string"?{v:n,ts:null}:typeof n=="object"&&n.v!=null?n:null:null},[v]),me=(e,s,a,n)=>{const l=$(e,s,a),i={...v};n?i[l]={v:n,ts:Date.now()}:delete i[l],U(i),localStorage.setItem("DMX_RESULTS_V1",JSON.stringify(i))},he=e=>{if(e==="pares"){const s=String(S(1,40)).padStart(2,"0");let a=String(S(1,40)).padStart(2,"0");return a===s&&(a=String(parseInt(a,10)%40+1).padStart(2,"0")),`${s}.${a}`}return e==="l2"?String(S(0,99)).padStart(2,"0"):e==="l3"||e==="sw3"?String(S(0,999)).padStart(3,"0"):"â€”"},O=(e,s,a)=>{const n=S(12,36),l=[],i=A[e]??100,r=[1,2,5,10,20,50];for(let c=0;c<n;c++){const u=C(r);l.push({outlet:C(ue),teller:C(de),ticket:oe(),result:a,bet_amount:u,prize:u*i,status:Math.random()>.75?"Pending":"Paid"})}return l},Z=d.useCallback((e,s,a)=>{if(!!(a&&a.v))return a.ts&&Date.now()>=a.ts+le*60*1e3?"locked":"published";if(e>m)return"upcoming";if(e===m){const l=G(s),i=Math.max(0,l-J);return Y()>=i?"open":"upcoming"}return"open"},[m]),ee=e=>e!=="locked"&&e!=="upcoming",xe=(e,s,a)=>{try{const n=JSON.parse(localStorage.getItem(g(e,s,a))||"[]"),l=n.reduce((i,r)=>i+(+r?.prize||0),0);return{count:n.length,payout:l}}catch{return{count:0,payout:0}}};d.useEffect(()=>{const e="DMX_DEMO_SEEDED_V1";if(localStorage.getItem(e)===m)return;const a={...v};let n=!1;Object.entries({pares:{schedules:N.pares},l2:{schedules:N.l2},l3:{schedules:N.l3},sw3:{schedules:N.sw3}}).forEach(([l,i])=>{(i.schedules||[]).forEach(r=>{const c=G(r);if(Y()>=c-J){const u=$(m,l,r);if(!a[u]||!a[u].v){const x=he(l);a[u]={v:x,ts:Date.now()-Math.floor(Math.random()*2e3)};const ae=O(l,r,x);localStorage.setItem(g(m,l,r),JSON.stringify(ae));const z=Math.max(ae.length,120),Se=Math.max(z+1,1200),ge=Math.floor(Math.random()*(Se-z+1))+z;localStorage.setItem(k(m,l,r),JSON.stringify({totalTickets:ge})),n=!0}}})}),n&&(U(a),localStorage.setItem("DMX_RESULTS_V1",JSON.stringify(a))),localStorage.setItem(e,m)},[m,v]);const te={pares:{format:"01.02",help:"Enter two different numbers from 01-40, separated by a period (e.g., 05.23)",validate:e=>{const s=/^(\d{2})\.(\d{2})$/.exec(e);if(!s)return!1;const a=parseInt(s[1],10),n=parseInt(s[2],10);return!(a<1||a>40||n<1||n>40||a===n)}},l2:{format:"00",help:"Enter a 2-digit number from 00-99 (e.g., 05, 42, 99)",validate:e=>/^\d{2}$/.test(e)&&+e>=0&&+e<=99},l3:{format:"000",help:"Enter a 3-digit number from 000-999 (e.g., 005, 123, 999)",validate:e=>/^\d{3}$/.test(e)&&+e>=0&&+e<=999},sw3:{format:"000",help:"Enter a 3-digit number from 000-999 (e.g., 005, 123, 999)",validate:e=>/^\d{3}$/.test(e)&&+e>=0&&+e<=999}},pe=(e,s)=>{T(!1);const a=I(o,e,s),n=Z(o,s,a);if(!ee(n)){alert(n==="locked"?"Editing is locked an hour after the result is saved.":"This draw is upcoming and not editable yet.");return}const l=te[e]||te.l2,i={name:_[e]||e,schedules:N[e],format:l.format,help:l.help,validate:l.validate};K({game:e,time:s,def:i,entry:a}),L(a?.v||""),V(!0)},b=()=>{V(!1),K(null),L("")},se=e=>{if(e.preventDefault(),!p)return;const{game:s,time:a,def:n}=p,l=X.trim();if(l&&n&&typeof n.validate=="function"&&!n.validate(l)){alert(`Invalid format. ${n.help}`),D.current?.focus();return}if(me(o,s,a,l),l)try{const i=JSON.parse(localStorage.getItem(g(o,s,a))||"[]");if(!i||i.length===0){const r=O(s,a,l);localStorage.setItem(g(o,s,a),JSON.stringify(r));const c=Math.max(r.length,120),u=Math.max(c+1,1200),x=Math.floor(Math.random()*(u-c+1))+c;localStorage.setItem(k(o,s,a),JSON.stringify({totalTickets:x}))}}catch{}else localStorage.setItem(g(o,s,a),"[]");b()},fe=(e,s)=>{try{const a=g(o,e,s);let n=JSON.parse(localStorage.getItem(a)||"[]");const l=I(o,e,s)?.v||"â€”";!n.length&&l!=="â€”"&&(n=O(e,s,l),localStorage.setItem(a,JSON.stringify(n)));const i=A[e]??100;n=n.map((c,u)=>({...c,__i:u,bet_amount:c.bet_amount??(typeof c.bet=="number"?c.bet:1),prize:c.prize??(c.bet_amount||1)*i}));let r=null;try{r=JSON.parse(localStorage.getItem(k(o,e,s))||"null")}catch{}if(!r){const c=Math.max(n.length,120),u=Math.max(c+1,1200);r={totalTickets:Math.floor(Math.random()*(u-c+1))+c},localStorage.setItem(k(o,e,s),JSON.stringify(r))}Q({game:e,time:s,winners:n,stats:r,gameName:_[e]||e}),q(""),B({key:"idx",dir:"asc"}),T(!0)}catch(a){console.error("Error opening winners drawer:",a)}},R=()=>{T(!1),Q(null)},je=(e,s)=>{const{key:a,dir:n}=s,l=(r,c)=>c==="idx"?r.__i??0:c==="prize"?+r.prize||0:c==="bet_amount"?+r.bet_amount||0:c==="status"?{Pending:0,Paid:1}[r.status]??2:String(r[c]??"").toLowerCase();if(a==="idx")return[...e].sort((r,c)=>(r.__i-c.__i)*(n==="asc"?1:-1));const i=n==="asc"?1:-1;return[...e].sort((r,c)=>{const u=l(r,a),x=l(c,a);return typeof u=="number"&&typeof x=="number"?(u-x)*i:String(u).localeCompare(String(x),"en",{numeric:!0,sensitivity:"base"})*i})},y=e=>B(s=>s.key===e?{key:e,dir:s.dir==="asc"?"desc":"asc"}:{key:e,dir:"asc"}),w=(()=>{if(!j)return[];let e=j.winners;if(P){const s=P.toLowerCase();e=e.filter(a=>`${a.teller} ${a.ticket} ${a.bet_amount} ${a.status} ${a.prize}`.toLowerCase().includes(s))}return je(e,ie)})(),M=j?{totalTickets:j.stats?.totalTickets||j.winners.length,totalWinners:w.length,totalPayout:w.reduce((e,s)=>e+(+s.prize||0),0),paid:w.filter(e=>e.status==="Paid").reduce((e,s)=>e+(+s.prize||0),0),pending:w.filter(e=>e.status==="Pending").reduce((e,s)=>e+(+s.prize||0),0)}:null;d.useEffect(()=>{const e=h||f;return document.body.classList.toggle("dmx-lock",e),document.body.classList.toggle("dmx-blur-bg",e),()=>{document.body.classList.remove("dmx-lock","dmx-blur-bg")}},[h,f]),d.useEffect(()=>{h&&D.current&&setTimeout(()=>D.current?.focus(),120)},[h]),d.useEffect(()=>{const e=a=>{a.key==="Escape"&&(h?b():f&&R())},s=a=>{a.key==="Enter"&&h&&!a.shiftKey&&!a.ctrlKey&&(a.preventDefault(),se(a))};return document.addEventListener("keydown",e),document.addEventListener("keydown",s),()=>{document.removeEventListener("keydown",e),document.removeEventListener("keydown",s)}},[h,f]);const W=o===m?"today":o<m?"archive":"future",Ne=W==="today"?"Today":W==="archive"?"Archive":"Future";return t.jsxs("div",{className:"dmx",children:[t.jsx("div",{className:"dmx-wrap",children:t.jsxs("section",{className:"game-card",children:[t.jsx("div",{className:"card-section",children:t.jsxs("div",{className:"filters",children:[t.jsxs("div",{className:"search-section",children:[t.jsx("label",{className:"search-label",htmlFor:"dmx-search",children:"Search Draws"}),t.jsxs("div",{className:"search-container",children:[t.jsx("input",{id:"dmx-search",type:"text",className:"search-input",placeholder:"Search draws, times, resultsâ€¦",value:E,onChange:e=>ce(e.target.value)}),t.jsx("div",{className:"search-icon","aria-hidden":!0,children:"ðŸ”"})]})]}),t.jsxs("div",{className:"date-section",children:[t.jsx("label",{className:"date-label",htmlFor:"dmx-date",children:"Select Date"}),t.jsxs("div",{className:"date-controls",children:[t.jsx("input",{id:"dmx-date",className:"date-input",type:"date",value:o,max:m,onChange:e=>re(e.target.value)}),t.jsxs("div",{className:`status-badge ${W}`,children:[t.jsx("span",{className:"status-dot"}),t.jsx("span",{children:Ne})]})]})]})]})}),["pares","l2","l3","sw3"].map(e=>t.jsxs("div",{className:"card-section game-block","data-game":e,children:[t.jsxs("header",{className:"game-header",children:[t.jsx("div",{className:"game-title",children:_[e]}),t.jsxs("div",{className:"game-date",children:["Draw Date: ",t.jsx("span",{className:"js-card-date",children:H(o)})]})]}),t.jsxs("table",{className:"game-table",role:"grid",children:[t.jsx("thead",{children:t.jsxs("tr",{children:[t.jsx("th",{children:"Draw Time"}),t.jsx("th",{children:"Status"}),t.jsx("th",{children:"Results"}),t.jsx("th",{children:"Payout"}),t.jsx("th",{children:"Details"}),t.jsx("th",{children:"Actions"})]})}),t.jsx("tbody",{children:N[e].map(s=>{const a=I(o,e,s),n=Z(o,s,a),l=n==="published"||n==="locked",i=l?xe(o,e,s):{count:0,payout:0},r=a?.v||"â€”",c=!E||`${s} ${n} ${r} ${_[e]}`.toLowerCase().includes(E.toLowerCase());return t.jsxs("tr",{className:"time-slot","data-game":e,"data-time":s,style:{display:c?"":"none"},children:[t.jsx("td",{className:"td-time","data-label":"Draw Time",children:t.jsx("div",{className:"cell cell-time",children:s})}),t.jsx("td",{className:"td-status","data-label":"Status",children:t.jsx("div",{className:"cell",children:t.jsx("span",{className:`slot-status ${n}`,"data-status":n,children:n.toUpperCase()})})}),t.jsx("td",{className:"td-result","data-label":"Results",children:t.jsx("div",{className:"cell",children:t.jsx("span",{className:"result-value",children:r})})}),t.jsx("td",{className:"td-payout","data-label":"Payout",children:t.jsx("div",{className:"cell",children:l?t.jsxs("span",{className:"inline-badge payout",children:["ðŸ’¸ â‚±",i.payout.toLocaleString()]}):t.jsx("span",{children:"â€”"})})}),t.jsx("td",{className:"td-winners-count","data-label":"Details",children:t.jsx("div",{className:"cell",children:t.jsxs("button",{type:"button",className:"winners-button",onClick:()=>fe(e,s),children:["ðŸ‘¥ Winners (",i.count,")"]})})}),t.jsx("td",{className:"td-actions","data-label":"Actions",children:t.jsx("div",{className:"cell cell-actions",children:t.jsx("button",{type:"button",className:"action-button",onClick:()=>pe(e,s),disabled:!ee(n),children:n==="published"?"Edit Result":n==="locked"?"View Result":"Enter Result"})})})]},s)})})]})]},e))]})}),h&&p&&ne.createPortal(t.jsxs(t.Fragment,{children:[t.jsx("div",{className:`dmx-modal-overlay ${h?"active":""}`,onClick:b}),t.jsx("div",{className:"dmx-modal",role:"dialog","aria-modal":"true","aria-labelledby":"dmx-modal-title",children:t.jsxs("div",{className:"modal-panel",children:[t.jsxs("div",{className:"modal-header",children:[t.jsx("button",{type:"button",className:"modal-close",onClick:b,children:"Ã—"}),t.jsx("h3",{id:"dmx-modal-title",className:"modal-title",children:"Enter Draw Result"}),t.jsxs("div",{className:"modal-meta",children:[t.jsx("span",{className:"meta-tag",children:H(o)}),t.jsx("span",{className:"meta-tag",children:p.time}),t.jsx("span",{className:"meta-tag",children:p.def.name})]})]}),t.jsxs("div",{className:"modal-body",children:[t.jsx("label",{className:"form-label",htmlFor:"dmx-input",children:"Enter Result"}),t.jsx("input",{ref:D,id:"dmx-input",className:"form-input",type:"text",placeholder:p.def.format,value:X,onChange:e=>L(e.target.value),autoComplete:"off"}),t.jsx("div",{className:"form-help",children:p.def.help})]}),t.jsxs("div",{className:"modal-footer",children:[t.jsx("button",{type:"button",className:"modal-button secondary",onClick:b,children:"Cancel"}),t.jsx("button",{type:"button",className:"modal-button primary",onClick:se,children:"Save Result"})]})]})})]}),document.body),f&&ne.createPortal(t.jsxs(t.Fragment,{children:[t.jsx("div",{className:`dmx-winners-overlay ${f?"active":""}`,onClick:R}),t.jsxs("div",{className:`dmx-winners-drawer ${f?"active":""}`,children:[t.jsxs("div",{className:"winners-header",children:[t.jsxs("div",{className:"winners-header-title",children:[t.jsx("div",{className:"winners-title",children:"Winners Details"}),t.jsxs("div",{className:"winners-subtitle",children:[j?.gameName," â€¢ ",j?.time]})]}),t.jsxs("div",{className:"winners-header-actions",children:[t.jsx("button",{type:"button",className:"winners-print",onClick:()=>window.print(),children:"Print"}),t.jsx("button",{type:"button",className:"winners-close",onClick:R,children:"Ã—"})]})]}),t.jsxs("div",{className:"winners-content",children:[t.jsxs("section",{className:"w-summary",children:[t.jsxs("div",{className:"summary-card",children:[t.jsx("div",{className:"summary-value",children:M?.totalTickets.toLocaleString()}),t.jsx("div",{className:"summary-label",children:"Total Tickets"})]}),t.jsxs("div",{className:"summary-card",children:[t.jsx("div",{className:"summary-value",children:M?.totalWinners.toLocaleString()}),t.jsx("div",{className:"summary-label",children:"Total Winners"})]}),t.jsxs("div",{className:"summary-card",children:[t.jsxs("div",{className:"summary-value",children:["â‚±",M?.totalPayout.toLocaleString()]}),t.jsx("div",{className:"summary-label",children:"Total Payout"})]})]}),t.jsx("section",{className:"winners-controls",children:t.jsx("input",{className:"wc-input",type:"search",placeholder:"Search all winnersâ€¦",value:P,onChange:e=>q(e.target.value)})}),t.jsx("section",{children:t.jsxs("table",{className:"winners-table",children:[t.jsx("thead",{children:t.jsxs("tr",{children:[t.jsx("th",{className:"sortable",onClick:()=>y("idx"),children:"#"}),t.jsx("th",{className:"sortable",onClick:()=>y("teller"),children:"Teller"}),t.jsx("th",{className:"sortable",onClick:()=>y("ticket"),children:"Ticket#"}),t.jsx("th",{className:"sortable",onClick:()=>y("bet_amount"),children:"Bet Amount"}),t.jsx("th",{className:"sortable money",onClick:()=>y("prize"),children:"Prize"}),t.jsx("th",{className:"sortable status",onClick:()=>y("status"),children:"Status"})]})}),t.jsx("tbody",{children:w.map((e,s)=>t.jsxs("tr",{children:[t.jsx("td",{children:s+1}),t.jsx("td",{children:e.teller}),t.jsx("td",{children:e.ticket}),t.jsxs("td",{className:"money",children:["â‚±",Number(e.bet_amount||0).toLocaleString()]}),t.jsxs("td",{className:"money",children:["â‚±",Number(e.prize||0).toLocaleString()]}),t.jsx("td",{className:"status",children:t.jsx("span",{className:`status-${(e.status||"Paid").toLowerCase()}`,children:e.status||"Paid"})})]},`${e.ticket}-${s}`))})]})}),t.jsxs("section",{className:"w-payouts",children:[t.jsxs("div",{className:"summary-card",children:[t.jsxs("div",{className:"summary-value",children:["â‚±",M?.paid.toLocaleString()]}),t.jsx("div",{className:"summary-label",children:"Paid Out"})]}),t.jsxs("div",{className:"summary-card",children:[t.jsxs("div",{className:"summary-value",children:["â‚±",M?.pending.toLocaleString()]}),t.jsx("div",{className:"summary-label",children:"Pending"})]})]}),t.jsxs("section",{className:"w-card logs-card",children:[t.jsxs("div",{className:"w-audit-row",children:[t.jsx("strong",{children:"Result Published:"}),t.jsxs("span",{children:["Admin User â€¢ ",new Date().toLocaleString()]})]}),t.jsxs("div",{className:"w-audit-row",children:[t.jsx("strong",{children:"Winners Calculated:"}),t.jsxs("span",{children:["System â€¢ ",new Date().toLocaleString()]})]}),t.jsxs("div",{className:"w-audit-row",children:[t.jsx("strong",{children:"Last Modified:"}),t.jsxs("span",{children:["Admin User â€¢ ",new Date().toLocaleString()]})]})]})]})]})]}),document.body)]})};export{we as default};
