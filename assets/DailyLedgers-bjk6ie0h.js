import{r as x,j as e}from"./index-DANIss5C.js";const be=()=>{const T=()=>{const s=new Date,t=s.getFullYear(),a=String(s.getMonth()+1).padStart(2,"0"),n=String(s.getDate()).padStart(2,"0");return`${t}-${a}-${n}`},[f,K]=x.useState(T()),[S,Q]=x.useState(T()),[y,M]=x.useState("none"),[C,$]=x.useState("none"),[h,X]=x.useState("none"),[_,ee]=x.useState(""),[R,se]=x.useState(!1),[B,k]=x.useState(!1),[ae,F]=x.useState(!1),te=x.useRef(0),v={"AREA-01":{name:"Area 1 - Downtown",tellers:["CPZ-00016 - RELANO, VIC","CPZ-00020 - SANTOS, MARIA"],collector:"COL-01 - CRUZ, PEDRO"},"AREA-02":{name:"Area 2 - Uptown",tellers:[],collector:"COL-02 - REYES, MARIA"}},I=[{id:"COL-01",name:"COL-01 - CRUZ, PEDRO",area:"AREA-01"},{id:"COL-02",name:"COL-02 - REYES, MARIA",area:"AREA-02"}],ne=s=>{M(s),$("none")},le=s=>{$(s),M("none")},re=()=>{k(!0),setTimeout(()=>{se(!0),k(!1)},250)},ce=()=>window.print(),[m,j]=x.useState({date:T(),agent:"",transType:"DEFICIT",description:"",amount:"",amountType:"debit"}),E=()=>{j(s=>({...s,agent:h!=="none"?h:s.agent||"",date:s.date||T()})),F(s=>!s)},U=["2025-10-01","2025-10-02","2025-10-03","2025-10-04","2025-10-05","2025-10-06","2025-10-07"],q={};U.forEach(s=>{q[s]={"CPZ-00016":0,"CPZ-00020":0,"CPZ-00025":0}});const Z=(s,t,a,n,l,c,o,u,p)=>[{id:`${a}-S2PM-${s}`,date:s,time:"13:45:00",drawTime:"2pm",agent:t,agentId:a,type:"Teller",area:"AREA-01",transType:"SALES",description:"Game Sales - STL PARES",debit:n,credit:0,game:"STL PARES",hits:"-"},{id:`${a}-N2PM-${s}`,date:s,time:"14:05:00",drawTime:"2pm",agent:t,agentId:a,type:"Teller",area:"AREA-01",transType:"NET",description:"Net Commission (15%)",debit:0,credit:Math.round(n*.15*100)/100,game:"-",hits:"-"},{id:`${a}-P2PM-${s}`,date:s,time:"14:30:00",drawTime:"2pm",agent:t,agentId:a,type:"Teller",area:"AREA-01",transType:"PAYOUT",description:"Winning Payouts (2pm)",debit:0,credit:c*o,game:"-",hits:`${c}*${o}`},{id:`${a}-S7PM-${s}`,date:s,time:"19:05:00",drawTime:"7pm",agent:t,agentId:a,type:"Teller",area:"AREA-01",transType:"SALES",description:"Game Sales - STL PARES",debit:l,credit:0,game:"STL PARES",hits:"-"},{id:`${a}-N7PM-${s}`,date:s,time:"19:20:00",drawTime:"7pm",agent:t,agentId:a,type:"Teller",area:"AREA-01",transType:"NET",description:"Net Commission (15%)",debit:0,credit:Math.round(l*.15*100)/100,game:"-",hits:"-"},{id:`${a}-P7PM-${s}`,date:s,time:"19:35:00",drawTime:"7pm",agent:t,agentId:a,type:"Teller",area:"AREA-01",transType:"PAYOUT",description:"Winning Payouts (7pm)",debit:0,credit:u*p,game:"-",hits:`${u}*${p}`},{id:`${a}-R-${s}`,date:s,time:"20:30:00",drawTime:"7pm",agent:t,agentId:a,type:"Teller",area:"AREA-01",transType:"REMITTANCE",description:"Remittance to Collector",debit:0,credit:Math.round((n+l)*.7*100)/100,game:"-",hits:"-"}],Y=[];U.forEach((s,t)=>{const a=1800+t*50,n=1500+t*45,l=1600+t*45,c=1400+t*40,o=20+t*2,u=500,p=30+t*2,b=700,r=15+t*3,i=450,d=18+t*2;Y.push(...Z(s,"CPZ-00016 - RELANO, VIC","CPZ-00016",a,n,o,u,p,b),...Z(s,"CPZ-00020 - SANTOS, MARIA","CPZ-00020",l,c,r,i,d,600))});const[G,oe]=x.useState(Y),D=()=>{const s=Object.values(v).flatMap(t=>t.tellers);return[...new Set(s)]},z=s=>s==="none"||s==="all"?D():v[s]?.tellers||[],J=s=>{if(s==="none"||s==="all")return D();const t=I.find(a=>a.id===s);return t?v[t.area]?.tellers||[]:[]},O=()=>h!=="none"?[h]:y!=="none"?z(y):C!=="none"?J(C):D(),P=x.useMemo(()=>{if(!R)return[];const s=new Date(f),t=new Date(S),a=O(),n=_.toLowerCase();return G.filter(l=>{const c=new Date(l.date),o=c>=s&&c<=t,u=a.includes(l.agent),p=u,b=l.agent.toLowerCase().includes(n)||l.description.toLowerCase().includes(n)||l.transType.toLowerCase().includes(n);return o&&p&&b}).sort((l,c)=>l.date!==c.date?new Date(l.date)-new Date(c.date):l.time.localeCompare(c.time))},[R,G,f,S,h,y,C,_]),ie=(s,t)=>{const a=(t||"").split(" - ")[0];return q[s]?.[a]??0},de=(s,t,a={})=>{const n=[...new Set(s.map(r=>r.agentId))],l={};n.forEach(r=>{const i=s.find(N=>N.agentId===r)?.agent||r,d=a[r];l[r]=d!==void 0?d:ie(t,i)||0});const c=n.reduce((r,i)=>r+(l[i]??0),0),u=s.slice().sort((r,i)=>{const d=!!r.manual,N=!!i.manual;if(d!==N)return d?1:-1;const w=r.time.localeCompare(i.time);if(w!==0)return w;const A=r.manualSeq??0,Ne=i.manualSeq??0;return A-Ne}).map(r=>{const i=r.agentId,d=(l[i]??0)+r.debit-r.credit;return l[i]=d,{...r,balance:d}}),p={...l},b=n.reduce((r,i)=>r+(p[i]??0),0);return{withBalances:u,openingSum:c,closingSum:b,closingMap:p}},V=P.reduce((s,t)=>{const a=`${t.date}___${t.agentId}`;return s[a]||(s[a]={date:t.date,agentId:t.agentId,agent:t.agent,items:[]}),s[a].items.push(t),s},{}),me=Object.keys(V).sort((s,t)=>{const[a,n]=s.split("___"),[l,c]=t.split("___"),o=new Date(a)-new Date(l);return o!==0?o:n.localeCompare(c)});let L={};const W=me.map(s=>{const t=V[s],{date:a,agentId:n,agent:l,items:c}=t,{withBalances:o,openingSum:u,closingSum:p,closingMap:b}=de(c,a,{[n]:L[n]});L={...L,...b};const r=o.reduce((d,N)=>d+N.debit,0),i=o.reduce((d,N)=>d+N.credit,0);return{date:a,agentId:n,agent:l,data:o,openingBalance:u,closingBalance:p,dayDebit:r,dayCredit:i}}),he=P.reduce((s,t)=>s+t.debit,0),ue=P.reduce((s,t)=>s+t.credit,0),pe=s=>{switch((s||"").toUpperCase()){case"SALES":return"trans-sales";case"NET":return"trans-net";case"PAYOUT":return"trans-payout";case"REMITTANCE":return"trans-remittance";case"COLLECTION":return"trans-collection";case"DEFICIT":return"trans-tapada";case"FORCE BALANCE":return"trans-force";default:return""}},xe=(s,t,a=!1)=>{if(a)return"Maria Santos";const n=(s||"").toUpperCase();return n==="SALES"?"System":n==="NET"||n==="PAYOUT"?"Juan Dela Cruz":n==="DEFICIT"||n==="REMITTANCE"?H(t):n==="FORCE BALANCE"?"Maria Santos":"-"},H=s=>{for(const[t,a]of Object.entries(v))if(a.tellers.some(n=>n.startsWith(s)))return a.collector;return"COL-01 - CRUZ, PEDRO"},g=s=>(s<0?"-":"")+"‚Ç±"+Math.abs(s).toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2}),ge=s=>{s.preventDefault();const{date:t,transType:a,description:n,amount:l,amountType:c}=m,o=h!=="none"?h:m.agent;if(!o)return;const u=o.split(" - ")[0],p=Object.keys(v).find(A=>v[A].tellers.includes(o))||"AREA-01",r=new Date().toTimeString().split(" ")[0],i=[],d=parseFloat(l||"0")||0,N=c==="debit"?d:0,w=c==="credit"?d:0;i.push({id:`L${Math.floor(Math.random()*1e5)}`,date:t,time:r,drawTime:"-",agent:o,agentId:u,area:p,type:"Teller",transType:(a||"DEFICIT").toUpperCase(),description:n||"-",debit:N,credit:w,game:"-",hits:"-",manual:!0,manualSeq:te.current++}),oe(A=>[...A,...i]),F(!1),j({date:T(),agent:h!=="none"?h:"",transType:"DEFICIT",description:"",amount:"",amountType:"debit"})},je=y!=="none"?z(y):C!=="none"?J(C):D();return e.jsxs("div",{className:"os-ledgers-container",children:[e.jsx("header",{className:"os-ledgers-header no-print",children:e.jsx("div",{className:"os-ledgers-header-content",children:e.jsxs("div",{className:"os-ledgers-header-main",children:[e.jsx("span",{className:"os-ledgers-icon",children:"üìí"}),e.jsxs("div",{className:"os-ledgers-header-text",children:[e.jsx("h1",{className:"os-ledgers-title",children:"Daily Ledgers"}),e.jsx("p",{className:"os-ledgers-subtitle",children:"Generate and review daily ledgers per area, teller, and collector."})]})]})})}),e.jsxs("section",{className:"os-ledgers-filters-card no-print",children:[e.jsxs("div",{className:"os-ledgers-filters",children:[e.jsxs("div",{className:"os-filter-group",children:[e.jsx("label",{className:"os-filter-label",children:"Date from"}),e.jsx("input",{type:"date",className:"os-date-input",value:f,onChange:s=>K(s.target.value)})]}),e.jsxs("div",{className:"os-filter-group",children:[e.jsx("label",{className:"os-filter-label",children:"Date to"}),e.jsx("input",{type:"date",className:"os-date-input",value:S,onChange:s=>Q(s.target.value)})]}),e.jsxs("div",{className:"os-filter-group",children:[e.jsx("label",{className:"os-filter-label",children:"Filter by Area"}),e.jsxs("select",{className:"os-select-input",value:y,onChange:s=>ne(s.target.value),children:[e.jsx("option",{value:"none",children:"No selected Area"}),Object.keys(v).map(s=>e.jsx("option",{value:s,children:v[s].name},s))]})]}),e.jsxs("div",{className:"os-filter-group",children:[e.jsx("label",{className:"os-filter-label",children:"Filter by Collector"}),e.jsxs("select",{className:"os-select-input",value:C,onChange:s=>le(s.target.value),children:[e.jsx("option",{value:"none",children:"No selected Collector"}),I.map(s=>e.jsx("option",{value:s.id,children:s.name},s.id))]})]}),e.jsxs("div",{className:"os-filter-group",children:[e.jsx("label",{className:"os-filter-label",children:"Specific Agent"}),e.jsxs("select",{className:"os-select-input",value:h,onChange:s=>X(s.target.value),children:[e.jsx("option",{value:"none",children:"No agent Selected"}),je.map((s,t)=>e.jsx("option",{value:s,children:s},t))]})]}),e.jsxs("div",{className:"os-filter-group os-filter-search",children:[e.jsx("label",{className:"os-filter-label",children:"Search"}),e.jsxs("div",{className:"os-search-wrapper",children:[e.jsx("span",{className:"os-search-icon",children:"üîé"}),e.jsx("input",{type:"text",className:"os-search-input",placeholder:"Search agent, description, or transaction...",value:_,onChange:s=>ee(s.target.value)})]})]})]}),e.jsxs("div",{className:"os-ledgers-actions",children:[e.jsxs("button",{className:"os-btn-generate",onClick:re,disabled:B,children:[e.jsx("span",{children:"‚öôÔ∏è"}),e.jsx("span",{children:B?"Generating‚Ä¶":"Generate"})]}),e.jsxs("button",{className:"os-btn-manual",onClick:E,children:[e.jsx("span",{children:"‚ûï"}),e.jsx("span",{children:"Manual Entry"})]}),e.jsxs("button",{className:"os-btn-print",onClick:ce,children:[e.jsx("span",{children:"üñ®Ô∏è"}),e.jsx("span",{children:"Print"})]}),e.jsxs("button",{className:"os-btn-export",children:[e.jsx("span",{children:"‚¨áÔ∏è"}),e.jsx("span",{children:"Export CSV"})]})]})]}),R?e.jsxs("section",{className:"os-ledgers-preview-card",children:[e.jsxs("div",{className:"os-ledgers-summary no-print",children:[e.jsxs("div",{className:"os-summary-header",children:[e.jsx("h2",{className:"os-summary-title",children:"Summary"}),e.jsxs("div",{className:"os-summary-date",children:[f," ‚Üí ",S]})]}),e.jsxs("div",{className:"os-summary-grid",children:[e.jsxs("div",{className:"os-summary-stat",children:[e.jsx("span",{className:"os-stat-label",children:"Total Debit"}),e.jsx("span",{className:"os-stat-value debit",children:g(he)})]}),e.jsxs("div",{className:"os-summary-stat",children:[e.jsx("span",{className:"os-stat-label",children:"Total Credit"}),e.jsx("span",{className:"os-stat-value credit",children:g(ue)})]}),e.jsxs("div",{className:"os-summary-stat",children:[e.jsx("span",{className:"os-stat-label",children:"Agents in Scope"}),e.jsx("span",{className:"os-stat-value",children:O().length})]}),e.jsxs("div",{className:"os-summary-stat",children:[e.jsx("span",{className:"os-stat-label",children:"Days"}),e.jsx("span",{className:"os-stat-value",children:W.length})]})]})]}),e.jsx("div",{className:"os-ledgers-content",children:W.map((s,t)=>e.jsxs("div",{className:"os-day-section",children:[e.jsxs("div",{className:"os-day-header",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"os-day-title",children:new Date(s.date).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"})}),e.jsx("p",{className:"os-day-agent-label",children:s.agent})]}),e.jsxs("div",{className:"os-day-stats",children:[e.jsxs("div",{className:"os-day-stat",children:[e.jsx("span",{className:"os-day-stat-label",children:"Opening:"}),e.jsx("span",{className:`os-day-stat-value ${s.openingBalance<0?"negative":"positive"}`,children:g(s.openingBalance)})]}),e.jsxs("div",{className:"os-day-stat",children:[e.jsx("span",{className:"os-day-stat-label",children:"Closing:"}),e.jsx("span",{className:`os-day-stat-value ${s.closingBalance<0?"negative":"positive"}`,children:g(s.closingBalance)})]})]})]}),e.jsx("div",{className:"os-ledgers-table-wrapper",children:e.jsxs("table",{className:"os-ledgers-table os-compact",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Time"}),e.jsx("th",{children:"Draw"}),e.jsx("th",{children:"Agent"}),e.jsx("th",{children:"Transaction"}),e.jsx("th",{children:"Description"}),e.jsx("th",{children:"Hits"}),e.jsx("th",{children:"Debit"}),e.jsx("th",{children:"Credit"}),e.jsx("th",{children:"Balance"}),e.jsx("th",{className:"no-print",children:"Encoder"})]})}),e.jsxs("tbody",{children:[s.openingBalance!==0&&e.jsxs("tr",{className:"os-opening-row",children:[e.jsx("td",{className:"os-td-time",children:"-"}),e.jsx("td",{className:"os-td-draw",children:"-"}),e.jsx("td",{className:"os-td-agent-compact",children:"-"}),e.jsx("td",{className:"os-td-trans",children:e.jsx("span",{className:"os-trans-badge trans-collection",children:"OPEN"})}),e.jsx("td",{className:"os-td-desc",children:"OPENING BALANCE"}),e.jsx("td",{className:"os-td-hits",children:"-"}),e.jsx("td",{className:"os-td-debit",children:"-"}),e.jsx("td",{className:"os-td-credit",children:"-"}),e.jsx("td",{className:`os-td-balance ${s.openingBalance<0?"negative":"positive"}`,children:g(s.openingBalance)}),e.jsx("td",{className:"no-print",children:"-"})]}),s.data.map(a=>{const n=a.debit<0?"negative":"",l=a.credit<0?"negative":"",c=a.balance<0?"negative":"positive";return e.jsxs("tr",{children:[e.jsx("td",{className:"os-td-time",children:a.time}),e.jsx("td",{className:"os-td-draw",children:a.drawTime}),e.jsx("td",{className:"os-td-agent-compact",children:a.agent}),e.jsx("td",{className:"os-td-trans",children:e.jsx("span",{className:`os-trans-badge ${pe(a.transType)}`,children:a.transType})}),e.jsx("td",{className:"os-td-desc",children:a.description}),e.jsx("td",{className:"os-td-hits",children:(a.transType==="PAYOUT",a.hits||"-")}),e.jsx("td",{className:`os-td-debit ${n}`,children:a.debit?g(a.debit):"-"}),e.jsx("td",{className:`os-td-credit ${l}`,children:a.credit?g(a.credit):"-"}),e.jsx("td",{className:`os-td-balance ${c}`,children:g(a.balance)}),e.jsx("td",{className:"os-td-encoder no-print",children:xe(a.transType,a.agentId,a.manual)})]},a.id)}),e.jsxs("tr",{className:"os-totals-row",children:[e.jsx("td",{colSpan:"6",className:"os-totals-label",children:"DAY TOTALS"}),e.jsx("td",{className:`os-totals-debit ${s.dayDebit<0?"negative":""}`,children:g(s.dayDebit)}),e.jsx("td",{className:`os-totals-credit ${s.dayCredit<0?"negative":""}`,children:g(s.dayCredit)}),e.jsx("td",{className:"os-totals-balance",children:e.jsx("strong",{className:s.closingBalance<0?"negative":"positive",children:g(s.closingBalance)})}),e.jsx("td",{className:"no-print",children:"-"})]})]})]})}),e.jsxs("div",{className:"os-print-signatures",children:[e.jsxs("div",{className:"os-signature-block",children:[e.jsx("div",{className:"os-signature-label",children:"Prepared By:"}),e.jsx("div",{className:"os-signature-line",children:"Juan Dela Cruz"}),e.jsx("div",{className:"os-signature-title",children:"Operations Support"})]}),e.jsxs("div",{className:"os-signature-block",children:[e.jsx("div",{className:"os-signature-label",children:"Checked By:"}),e.jsx("div",{className:"os-signature-line",children:"Juan Dela Cruz"}),e.jsx("div",{className:"os-signature-title",children:"Operations Support"})]}),e.jsxs("div",{className:"os-signature-block",children:[e.jsx("div",{className:"os-signature-label",children:"Verified By:"}),e.jsx("div",{className:"os-signature-line",children:"____________________"}),e.jsx("div",{className:"os-signature-title",children:"Authorized Signatory"})]})]})]},t))})]}):e.jsx("section",{className:"os-ledgers-placeholder no-print",children:e.jsxs("div",{className:"os-placeholder-content",children:[e.jsx("span",{className:"os-placeholder-icon",children:"üßæ"}),e.jsx("h3",{className:"os-placeholder-title",children:"No ledger generated yet"}),e.jsxs("p",{className:"os-placeholder-text",children:["Choose your date range and filters, then click ",e.jsx("strong",{children:"Generate"})," to preview the daily ledgers."]})]})}),ae&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"os-modal-overlay active",onClick:E}),e.jsx("div",{className:"os-modal-container active",children:e.jsxs("div",{className:"os-modal-content",children:[e.jsxs("div",{className:"os-modal-header",children:[e.jsx("h3",{children:"Manual Ledger Entry"}),e.jsx("button",{className:"os-modal-close",onClick:E,children:"√ó"})]}),e.jsxs("form",{onSubmit:ge,children:[e.jsxs("div",{className:"os-modal-body",children:[e.jsxs("div",{className:"os-form-group",children:[e.jsx("label",{className:"os-form-label",children:"Date"}),e.jsx("input",{type:"date",className:"os-form-input",value:m.date,onChange:s=>j({...m,date:s.target.value}),required:!0})]}),h!=="none"?e.jsxs("div",{className:"os-form-group",children:[e.jsx("label",{className:"os-form-label",children:"Agent (Teller)"}),e.jsx("input",{type:"text",className:"os-form-input",value:h,readOnly:!0})]}):e.jsxs("div",{className:"os-form-group",children:[e.jsx("label",{className:"os-form-label",children:"Agent (Teller)"}),e.jsxs("select",{className:"os-form-input",value:m.agent,onChange:s=>j({...m,agent:s.target.value}),required:!0,children:[e.jsx("option",{value:"",children:"Select a Teller"}),O().map((s,t)=>e.jsx("option",{value:s,children:s},t))]})]}),e.jsxs("div",{className:"os-form-group",children:[e.jsx("label",{className:"os-form-label",children:"Transaction Type"}),e.jsxs("select",{className:"os-form-input",value:m.transType,onChange:s=>j({...m,transType:s.target.value}),children:[e.jsx("option",{children:"SALES"}),e.jsx("option",{children:"NET"}),e.jsx("option",{children:"PAYOUT"}),e.jsx("option",{children:"REMITTANCE"}),e.jsx("option",{children:"COLLECTION"}),e.jsx("option",{children:"DEFICIT"}),e.jsx("option",{children:"FORCE BALANCE"})]})]}),e.jsxs("div",{className:"os-form-group",children:[e.jsx("label",{className:"os-form-label",children:"Amount"}),e.jsx("input",{type:"number",step:"0.01",className:"os-form-input",value:m.amount,onChange:s=>j({...m,amount:s.target.value}),required:!0}),e.jsxs("div",{className:"os-radio-group",children:[e.jsxs("label",{className:"os-radio-label",children:[e.jsx("input",{type:"radio",name:"amountType",value:"debit",checked:m.amountType==="debit",onChange:s=>j({...m,amountType:s.target.value})}),"Debit"]}),e.jsxs("label",{className:"os-radio-label",children:[e.jsx("input",{type:"radio",name:"amountType",value:"credit",checked:m.amountType==="credit",onChange:s=>j({...m,amountType:s.target.value})}),"Credit"]})]})]}),e.jsxs("div",{className:"os-form-group",children:[e.jsx("label",{className:"os-form-label",children:"Description"}),e.jsx("textarea",{className:"os-form-textarea",rows:"3",placeholder:"Description",value:m.description,onChange:s=>j({...m,description:s.target.value})})]})]}),e.jsxs("div",{className:"os-modal-footer",children:[e.jsx("button",{type:"button",className:"os-btn-secondary",onClick:E,children:"Cancel"}),e.jsx("button",{type:"submit",className:"os-btn-primary",onClick:()=>{h!=="none"&&j(s=>({...s,agent:h}))},children:"Add Entry"})]})]})]})})]})]})};export{be as default};
