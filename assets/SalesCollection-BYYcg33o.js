import{b as Y,a as q,r as o,j as e,L as K}from"./index-BVvE27mP.js";import{r as V}from"./index-B8FWDkwX.js";const X=[{id:"T001",name:"Juan Dela Cruz",code:"TLR001",location:"Booth A1",totalSales:25420,totalWinners:8650,surplus:16770,commission:1271,netCollection:15499,originalNetCollection:15499,collectedAmount:0,ticketsSold:87,winningTickets:5,status:"ready_collection",lastCollection:"2025-01-14 09:30 AM",contactNumber:"09171234567"},{id:"T002",name:"Maria Santos",code:"TLR002",location:"Booth B2",totalSales:18150,totalWinners:12200,surplus:5950,commission:907.5,netCollection:5042.5,originalNetCollection:5042.5,collectedAmount:5042.5,ticketsSold:134,winningTickets:8,status:"collected",lastCollection:"2025-01-15 12:30 PM",contactNumber:"09281234567"},{id:"T003",name:"Pedro Garcia",code:"TLR003",location:"Booth C3",totalSales:32750,totalWinners:18900,surplus:13850,commission:1637.5,netCollection:12212.5,originalNetCollection:12212.5,collectedAmount:0,ticketsSold:92,winningTickets:12,status:"ready_collection",lastCollection:"2025-01-14 10:15 AM",contactNumber:"09391234567"},{id:"T004",name:"Ana Reyes",code:"TLR004",location:"Booth D4",totalSales:28200,totalWinners:15600,surplus:12600,commission:1410,netCollection:11190,originalNetCollection:11190,collectedAmount:0,ticketsSold:156,winningTickets:18,status:"ready_collection",lastCollection:"2025-01-14 07:30 AM",contactNumber:"09401234567"},{id:"T005",name:"Carlos Lopez",code:"TLR005",location:"Booth E5",totalSales:22890,totalWinners:4250,surplus:18640,commission:1144.5,netCollection:17495.5,originalNetCollection:17495.5,collectedAmount:17495.5,ticketsSold:73,winningTickets:3,status:"collected",lastCollection:"2025-01-15 11:00 AM",contactNumber:"09511234567"},{id:"T006",name:"Rosa Martinez",code:"TLR006",location:"Booth F6",totalSales:15600,totalWinners:15600,surplus:0,commission:780,netCollection:0,originalNetCollection:0,collectedAmount:0,ticketsSold:45,winningTickets:12,status:"balanced",lastCollection:"2025-01-13 02:15 PM",contactNumber:"09621234567"},{id:"T007",name:"Miguel Fernandez",code:"TLR007",location:"Booth G7",totalSales:2850,totalWinners:0,surplus:2850,commission:142.5,netCollection:2707.5,originalNetCollection:2707.5,collectedAmount:0,ticketsSold:12,winningTickets:0,status:"ready_collection",lastCollection:"2025-01-12 04:30 PM",contactNumber:"09731234567"},{id:"T008",name:"Elena Gonzalez",code:"TLR008",location:"Booth H8",totalSales:0,totalWinners:0,surplus:0,commission:0,netCollection:0,originalNetCollection:0,collectedAmount:0,ticketsSold:0,winningTickets:0,status:"no_activity",lastCollection:"2025-01-10 11:45 AM",contactNumber:"09841234567"},{id:"T009",name:"Lisa Santos",code:"TLR009",location:"Booth I9",totalSales:1250,totalWinners:850,surplus:400,commission:62.5,netCollection:337.5,originalNetCollection:337.5,collectedAmount:0,ticketsSold:8,winningTickets:2,status:"ready_collection",lastCollection:"2025-01-13 09:10 AM",contactNumber:"09061234567"}],Z=[{id:"COL001",tellerId:"T002",tellerName:"Maria Santos",surplusAmount:5950,commissionDeducted:907.5,netCollected:5042.5,collectedAt:"2025-01-15 12:30 PM",collectedBy:"Collector C001",notes:"Surplus collection after winner payouts - verified cash count"},{id:"COL002",tellerId:"T005",tellerName:"Carlos Lopez",surplusAmount:18640,commissionDeducted:1144.5,netCollected:17495.5,collectedAt:"2025-01-15 12:45 PM",collectedBy:"Collector C001",notes:"Large surplus collection - minimal winners today"}],le=()=>{const F=Y(),{isAuthenticated:B,loading:f}=q();o.useEffect(()=>{!f&&!B&&F("/",{replace:!0})},[B,f,F]);const[r,P]=o.useState(X),[R,E]=o.useState(Z),[C,H]=o.useState(""),[p,W]=o.useState("ready_collection"),[l,b]=o.useState(null),[S,w]=o.useState(!1),[u,y]=o.useState(""),[h,v]=o.useState(""),[x,D]=o.useState(!1),[A,_]=o.useState({show:!1,message:"",type:"success"}),[d,T]=o.useState(!1),[k,L]=o.useState(null);o.useEffect(()=>(document.body.classList.add("sales-collection-bg"),()=>document.body.classList.remove("sales-collection-bg")),[]),o.useEffect(()=>{if(S){const s=document.documentElement.style.overflow,t=document.body.style.overflow;return document.documentElement.style.overflow="hidden",document.body.style.overflow="hidden",()=>{document.documentElement.style.overflow=s,document.body.style.overflow=t}}},[S]);const a=o.useMemo(()=>new Intl.NumberFormat("en-PH",{style:"currency",currency:"PHP",maximumFractionDigits:2}),[]),m=o.useCallback((s,t="success")=>{_({show:!0,message:s,type:t}),setTimeout(()=>_(c=>({...c,show:!1})),4e3)},[]),g=o.useMemo(()=>{const s=r.filter(i=>i.status==="ready_collection"),t=r.filter(i=>i.status==="collected"),c=s.reduce((i,N)=>i+N.netCollection,0),n=t.reduce((i,N)=>i+N.collectedAmount,0),J=t.reduce((i,N)=>i+N.commission,0);return{tellersReadyForCollection:s.length,tellersCollected:t.length,totalAvailableForCollection:c,totalCollectedToday:n,totalCommissionDeducted:J}},[r]),M=o.useMemo(()=>r.filter(s=>{const t=C.toLowerCase().trim(),c=!C||s.name.toLowerCase().includes(t)||s.code.toLowerCase().includes(t)||s.location.toLowerCase().includes(t),n=p==="all"||s.status===p;return c&&n}),[r,C,p]),I=o.useCallback(s=>{s.status==="collected"||s.status==="no_activity"||s.status==="balanced"||(b(s),y(s.netCollection.toString()),v(""),T(!1),L(null),w(!0))},[]),z=o.useCallback(s=>{const t=r.find(c=>c.id===s.tellerId);t&&(b(t),y(s.netCollected.toString()),v(s.notes||""),T(!0),L(s),w(!0))},[r]),j=o.useCallback(()=>{w(!1),b(null),y(""),v(""),T(!1),L(null)},[]),$=o.useCallback(async()=>{if(!l||!u||x)return;const s=parseFloat(u);if(isNaN(s)||s<=0){m("Please enter a valid amount","error");return}if(s>l.netCollection){m(`Amount cannot exceed ${a.format(l.netCollection)}`,"error");return}D(!0);try{if(await new Promise(t=>setTimeout(t,1500)),d&&k)E(t=>t.map(c=>c.id===k.id?{...c,surplusAmount:l.surplus,commissionDeducted:l.commission,netCollected:s,notes:h,collectedAt:new Date().toLocaleString("en-PH",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",hour12:!0})}:c)),P(t=>t.map(c=>c.id===l.id?{...c,collectedAmount:s,netCollection:c.originalNetCollection-s,status:s>=c.originalNetCollection?"collected":"ready_collection",lastCollection:new Date().toLocaleString("en-PH",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",hour12:!0})}:c)),m(`Collection updated for ${l.name}`,"success");else{const t={id:`COL${Date.now()}`,tellerId:l.id,tellerName:l.name,surplusAmount:l.surplus,commissionDeducted:l.commission,netCollected:s,collectedAt:new Date().toLocaleString("en-PH",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",hour12:!0}),collectedBy:"Collector C001",notes:h};E(c=>[t,...c]),P(c=>c.map(n=>n.id===l.id?{...n,collectedAmount:n.collectedAmount+s,netCollection:n.netCollection-s,status:s>=n.netCollection?"collected":"ready_collection",lastCollection:new Date().toLocaleString("en-PH",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",hour12:!0})}:n)),m(`Successfully collected ${a.format(s)} from ${l.name}`,"success")}j()}catch{m("Failed to process collection. Please try again.","error")}finally{D(!1)}},[l,u,h,x,d,k,a,m,j]),G=({children:s})=>typeof document<"u"?V.createPortal(s,document.body):null,O=()=>e.jsxs("div",{className:"stats-grid",children:[e.jsxs("div",{className:"stat-card ready",children:[e.jsx("div",{className:"stat-icon",children:"📥"}),e.jsx("div",{className:"stat-value",children:g.tellersReadyForCollection}),e.jsx("div",{className:"stat-label",children:"Ready for Collection"})]}),e.jsxs("div",{className:"stat-card collected",children:[e.jsx("div",{className:"stat-icon",children:"✅"}),e.jsx("div",{className:"stat-value",children:g.tellersCollected}),e.jsx("div",{className:"stat-label",children:"Collected Today"})]}),e.jsxs("div",{className:"stat-card available",children:[e.jsx("div",{className:"stat-icon",children:"💰"}),e.jsx("div",{className:"stat-value",children:a.format(g.totalAvailableForCollection)}),e.jsx("div",{className:"stat-label",children:"Available to Collect"})]}),e.jsxs("div",{className:"stat-card total",children:[e.jsx("div",{className:"stat-icon",children:"📊"}),e.jsx("div",{className:"stat-value",children:a.format(g.totalCollectedToday)}),e.jsx("div",{className:"stat-label",children:"Total Collected"})]})]}),Q=({teller:s})=>e.jsxs("div",{className:`teller-item status-${s.status}`,children:[e.jsxs("div",{className:"teller-header",children:[e.jsxs("div",{className:"teller-info",children:[e.jsx("h3",{children:s.name}),e.jsxs("p",{className:"teller-code",children:[s.code," • ",s.location]})]}),e.jsxs("div",{className:`status-badge ${s.status}`,children:[s.status==="ready_collection"&&"📥 Ready",s.status==="collected"&&"✅ Collected",s.status==="balanced"&&"⚖️ Balanced",s.status==="no_activity"&&"💤 No Activity"]})]}),e.jsxs("div",{className:"teller-details",children:[e.jsxs("div",{className:"detail-row",children:[e.jsx("span",{children:"Total Sales"}),e.jsx("span",{children:a.format(s.totalSales)})]}),e.jsxs("div",{className:"detail-row",children:[e.jsx("span",{children:"Winner Payouts"}),e.jsx("span",{children:a.format(s.totalWinners)})]}),e.jsxs("div",{className:"detail-row",children:[e.jsx("span",{children:"Gross Surplus"}),e.jsx("span",{className:"surplus",children:a.format(s.surplus)})]}),e.jsxs("div",{className:"detail-row",children:[e.jsx("span",{children:"Commission (5%)"}),e.jsxs("span",{className:"commission",children:["-",a.format(s.commission)]})]}),s.collectedAmount>0&&e.jsxs("div",{className:"detail-row",children:[e.jsx("span",{children:"Collected"}),e.jsx("span",{className:"collected",children:a.format(s.collectedAmount)})]}),e.jsxs("div",{className:"detail-row highlight",children:[e.jsx("span",{children:s.collectedAmount>0?"Remaining":"Net Collection"}),e.jsx("span",{className:"amount",children:a.format(s.netCollection)})]})]}),s.status==="ready_collection"&&s.netCollection>0&&e.jsx("button",{className:"collect-btn",onClick:()=>I(s),children:"💰 Collect Surplus"}),e.jsx("div",{className:"teller-footer",children:e.jsxs("span",{className:"last-collection",children:["Last: ",s.lastCollection]})})]}),U=({collection:s})=>e.jsxs("div",{className:"history-item",children:[e.jsxs("div",{className:"history-header",children:[e.jsxs("div",{children:[e.jsx("h4",{children:s.tellerName}),e.jsx("p",{className:"history-time",children:s.collectedAt})]}),e.jsx("div",{className:"history-amount",children:a.format(s.netCollected)})]}),e.jsxs("div",{className:"history-details",children:[e.jsxs("div",{className:"detail-row",children:[e.jsx("span",{children:"Gross Surplus"}),e.jsx("span",{children:a.format(s.surplusAmount)})]}),e.jsxs("div",{className:"detail-row",children:[e.jsx("span",{children:"Commission"}),e.jsxs("span",{children:["-",a.format(s.commissionDeducted)]})]}),e.jsxs("div",{className:"detail-row highlight",children:[e.jsx("span",{children:"Net Collected"}),e.jsx("span",{children:a.format(s.netCollected)})]})]}),s.notes&&e.jsxs("div",{className:"history-notes",children:[e.jsx("strong",{children:"Notes:"})," ",s.notes]}),e.jsxs("div",{className:"history-footer",children:[e.jsxs("span",{className:"collected-by",children:["By: ",s.collectedBy]}),e.jsx("button",{className:"edit-btn",onClick:()=>z(s),children:"✏️ Edit"})]})]});return f?e.jsx("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"100vh",fontSize:"1.25rem",color:"#6b7280"},children:"Loading..."}):e.jsxs("div",{className:"sales-collection-container",children:[e.jsxs("header",{className:"page-header",children:[e.jsxs("div",{children:[e.jsx("h1",{children:"Sales Collection"}),e.jsx("p",{className:"header-subtitle",children:"Collect remittances from tellers and update ledger records"})]}),e.jsxs(K,{to:"/collector",className:"back-btn","aria-label":"Back to Dashboard",children:[e.jsx("span",{"aria-hidden":"true",children:"←"})," Back To Dashboard"]})]}),e.jsxs("section",{className:"card statistics-section",children:[e.jsxs("h2",{className:"section-title",children:[e.jsx("span",{className:"section-icon",children:"📊"}),"Collection Summary"]}),e.jsx(O,{})]}),e.jsxs("section",{className:"card controls-section",children:[e.jsxs("h2",{className:"section-title",children:[e.jsx("span",{className:"section-icon",children:"🔍"}),"Search & Filter"]}),e.jsxs("div",{className:"controls-grid",children:[e.jsxs("div",{className:"control-group",children:[e.jsx("label",{htmlFor:"search",className:"control-label",children:"Search Tellers"}),e.jsx("input",{id:"search",type:"text",className:"control-input",placeholder:"Search by name, code, or location...",value:C,onChange:s=>H(s.target.value)})]}),e.jsxs("div",{className:"control-group",children:[e.jsx("label",{htmlFor:"status-filter",className:"control-label",children:"Filter by Status"}),e.jsxs("select",{id:"status-filter",className:"control-select",value:p,onChange:s=>W(s.target.value),children:[e.jsx("option",{value:"all",children:"All Statuses"}),e.jsx("option",{value:"ready_collection",children:"Ready for Collection"}),e.jsx("option",{value:"collected",children:"Collected"}),e.jsx("option",{value:"balanced",children:"Balanced"}),e.jsx("option",{value:"no_activity",children:"No Activity"})]})]})]})]}),e.jsxs("section",{className:"card tellers-section",children:[e.jsxs("h2",{className:"section-title",children:[e.jsx("span",{className:"section-icon",children:"👥"}),"Tellers with Surplus (",M.length,")"]}),M.length===0?e.jsxs("div",{className:"empty-state",children:[e.jsx("div",{className:"empty-icon",children:"🔍"}),e.jsx("div",{className:"empty-title",children:"No Tellers Found"}),e.jsx("div",{className:"empty-text",children:"Try adjusting your search criteria or filters."})]}):e.jsx("div",{className:"tellers-grid",children:M.map(s=>e.jsx(Q,{teller:s},s.id))})]}),e.jsxs("section",{className:"card history-section",children:[e.jsxs("h2",{className:"section-title",children:[e.jsx("span",{className:"section-icon",children:"📋"}),"Collection History"]}),R.length===0?e.jsxs("div",{className:"empty-state",children:[e.jsx("div",{className:"empty-icon",children:"📋"}),e.jsx("div",{className:"empty-title",children:"No Collections Yet"}),e.jsx("div",{className:"empty-text",children:"Collection records will appear here after you collect surplus amounts."})]}):e.jsx("div",{className:"history-grid",children:R.map(s=>e.jsx(U,{collection:s},s.id))})]}),S&&l&&e.jsx(G,{children:e.jsx("div",{className:"modal-overlay",role:"dialog","aria-modal":"true","aria-labelledby":"collection-modal-title",onClick:j,children:e.jsxs("div",{className:"modal",onClick:s=>s.stopPropagation(),children:[e.jsxs("div",{className:"modal-header",children:[e.jsx("h3",{id:"collection-modal-title",children:d?"Edit Collection":"Collect Surplus"}),e.jsx("button",{className:"modal-close",onClick:j,"aria-label":"Close modal",children:"×"})]}),e.jsxs("div",{className:"modal-body",children:[e.jsxs("div",{className:"teller-summary",children:[e.jsxs("h4",{children:[l.name," (",l.code,")"]}),e.jsxs("div",{className:"summary-grid",children:[e.jsxs("div",{className:"summary-item",children:[e.jsx("span",{children:"Total Sales"}),e.jsx("span",{children:a.format(l.totalSales)})]}),e.jsxs("div",{className:"summary-item",children:[e.jsx("span",{children:"Winner Payouts"}),e.jsx("span",{children:a.format(l.totalWinners)})]}),e.jsxs("div",{className:"summary-item",children:[e.jsx("span",{children:"Gross Surplus"}),e.jsx("span",{className:"surplus",children:a.format(l.surplus)})]}),e.jsxs("div",{className:"summary-item",children:[e.jsx("span",{children:"Commission (5%)"}),e.jsxs("span",{className:"commission",children:["-",a.format(l.commission)]})]}),l.collectedAmount>0&&e.jsxs("div",{className:"summary-item",children:[e.jsx("span",{children:"Already Collected"}),e.jsx("span",{className:"collected-highlight",children:a.format(l.collectedAmount)})]}),e.jsxs("div",{className:"summary-item",children:[e.jsx("span",{children:d?"Current Balance":l.collectedAmount>0?"Remaining Balance":"Net Collection"}),e.jsx("span",{className:"highlight",children:a.format(l.netCollection)})]})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"collection-amount",className:"form-label",children:"Collection Amount"}),e.jsx("input",{id:"collection-amount",type:"number",step:"0.01",min:"0",max:l.netCollection,className:"form-input",value:u,onChange:s=>y(s.target.value),autoFocus:!0}),e.jsx("div",{className:"form-help",children:d?"Update the collection amount. This will adjust the teller's balance accordingly.":"Enter the actual surplus amount collected. Can be partial or full amount."})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"collection-notes",className:"form-label",children:"Notes (Optional)"}),e.jsx("textarea",{id:"collection-notes",className:"form-textarea",placeholder:"Add any notes about this collection...",value:h,onChange:s=>v(s.target.value),maxLength:500}),e.jsxs("div",{className:"form-help",children:[h.length,"/500 characters"]})]})]}),e.jsxs("div",{className:"modal-footer",children:[e.jsx("button",{className:"btn btn-secondary",onClick:j,disabled:x,children:"Cancel"}),e.jsx("button",{className:"btn btn-primary",onClick:$,disabled:x||!u,children:x?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"spinner"}),"Processing..."]}):e.jsxs(e.Fragment,{children:[e.jsx("span",{children:d?"✏️":"💰"}),d?"Update Collection":"Complete Collection"]})})]})]})})}),A.show&&e.jsx("div",{className:`toast show ${A.type}`,children:A.message})]})};export{le as default};
