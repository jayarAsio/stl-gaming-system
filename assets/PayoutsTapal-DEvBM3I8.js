import{r as o,j as e,L as Z}from"./index-8iPTcRPW.js";import{r as ee}from"./index-BbYDvXq4.js";const se=[{id:"T001",name:"Juan Dela Cruz",code:"TLR001",location:"Booth A1",totalSales:8420,totalWinners:15650,shortage:7230,originalShortage:7230,paidAmount:0,ticketsSold:87,winningTickets:12,status:"needs_payout",lastPayout:"2025-01-14 03:30 PM",contactNumber:"09171234567"},{id:"T002",name:"Maria Santos",code:"TLR002",location:"Booth B2",totalSales:22150,totalWinners:18200,shortage:0,originalShortage:0,paidAmount:0,surplus:3950,ticketsSold:134,winningTickets:8,status:"surplus",lastPayout:"2025-01-13 11:45 AM",contactNumber:"09281234567"},{id:"T003",name:"Pedro Garcia",code:"TLR003",location:"Booth C3",totalSales:12750,totalWinners:28900,shortage:16150,originalShortage:16150,paidAmount:0,ticketsSold:92,winningTickets:18,status:"needs_payout",lastPayout:"2025-01-15 09:15 AM",contactNumber:"09391234567"},{id:"T004",name:"Ana Reyes",code:"TLR004",location:"Booth D4",totalSales:31200,totalWinners:45600,shortage:14400,originalShortage:14400,paidAmount:0,ticketsSold:156,winningTickets:22,status:"needs_payout",lastPayout:"2025-01-14 02:30 PM",contactNumber:"09401234567"},{id:"T005",name:"Carlos Lopez",code:"TLR005",location:"Booth E5",totalSales:18890,totalWinners:4250,shortage:0,originalShortage:0,paidAmount:0,surplus:14640,ticketsSold:73,winningTickets:3,status:"surplus",lastPayout:"2025-01-14 10:00 AM",contactNumber:"09511234567"}],te=[{id:"PAY001",tellerId:"T001",tellerName:"Juan Dela Cruz",amount:12500,type:"tapal",processedAt:"2025-01-15 01:30 PM",processedBy:"Collector C001",notes:"Emergency payout for major winner - jackpot prize",reason:"insufficient_funds"},{id:"PAY002",tellerId:"T003",tellerName:"Pedro Garcia",amount:8750,type:"tapal",processedAt:"2025-01-15 10:45 AM",processedBy:"Collector C001",notes:"Multiple winners exceeded daily sales",reason:"multiple_winners"}],ne=()=>{const[h,D]=o.useState(se),[B,R]=o.useState(te),[A,I]=o.useState(""),[S,z]=o.useState("needs_payout"),[r,T]=o.useState(null),[x,C]=o.useState(!1),[g,b]=o.useState(""),[v,w]=o.useState(""),[k,$]=o.useState(!1),[E,H]=o.useState({show:!1,message:"",type:"success"}),[_,j]=o.useState(""),[u,L]=o.useState(!1),[y,M]=o.useState(null),f=o.useRef(null);o.useEffect(()=>(document.body.classList.add("payout-tapal-bg"),()=>document.body.classList.remove("payout-tapal-bg")),[]),o.useEffect(()=>{if(x){const s=document.documentElement.style.overflow,a=document.body.style.overflow;return document.documentElement.style.overflow="hidden",document.body.style.overflow="hidden",()=>{document.documentElement.style.overflow=s,document.body.style.overflow=a}}},[x]),o.useEffect(()=>{if(!x)return;const s=()=>{const a=window.innerHeight*.01;document.documentElement.style.setProperty("--app-vh",`${a}px`)};return s(),window.addEventListener("resize",s),window.addEventListener("orientationchange",s),()=>{window.removeEventListener("resize",s),window.removeEventListener("orientationchange",s),document.documentElement.style.removeProperty("--app-vh")}},[x]),o.useEffect(()=>{if(!x)return;const s=setTimeout(()=>{const a=f.current;if(a){a.focus({preventScroll:!0});const t=a.value||"";a.setSelectionRange(t.length,t.length)}},0);return()=>clearTimeout(s)},[x]);const l=o.useMemo(()=>new Intl.NumberFormat("en-PH",{style:"currency",currency:"PHP",maximumFractionDigits:2}),[]),N=o.useCallback((s,a="success")=>{H({show:!0,message:s,type:a}),setTimeout(()=>H(t=>({...t,show:!1})),4e3)},[]),m=o.useMemo(()=>{const s=h.filter(c=>c.status==="needs_payout"),a=h.filter(c=>c.status==="surplus"),t=s.reduce((c,d)=>c+d.shortage,0),i=a.reduce((c,d)=>c+(d.surplus||0),0),n=h.reduce((c,d)=>c+d.paidAmount,0);return{tellersNeedingPayout:s.length,tellersWithSurplus:a.length,totalShortage:t,totalSurplus:i,totalPayoutsToday:n,netPosition:i-t}},[h]),F=o.useMemo(()=>h.filter(s=>{const a=A.trim().toLowerCase(),t=a===""||s.name.toLowerCase().includes(a)||s.code.toLowerCase().includes(a)||s.location.toLowerCase().includes(a),i=S==="all"||s.status===S;return t&&i}),[h,A,S]),p=o.useMemo(()=>r?u&&y?(y.amount||0)+(r.shortage||0):r.shortage||0:0,[r,u,y]),W=o.useCallback((s,a)=>{let t=String(s).replace(/[^\d.]/g,"");const i=t.indexOf(".");if(i!==-1&&(t=t.slice(0,i+1)+t.slice(i+1).replace(/\./g,"")),t.includes(".")){const[c,d]=t.split(".");t=c+"."+d.slice(0,2)}if(t.startsWith(".")&&(t="0"+t),t==="")return"";let n=parseFloat(t);return isNaN(n)?"":(n<0&&(n=0),typeof a=="number"&&n>a&&(n=a),n.toString())},[]),U=o.useCallback(s=>{const a=W(s.target.value,p);b(a),j(""),requestAnimationFrame(()=>{const t=f.current;if(t){const i=t.value||"";t.setSelectionRange(i.length,i.length),t.focus({preventScroll:!0})}})},[W,p]),O=o.useCallback(s=>{T(s),b((s.shortage??0).toString()),w(""),L(!1),M(null),j(""),C(!0)},[]),Y=o.useCallback(s=>{const a=h.find(t=>t.id===s.tellerId);a&&(T(a),b((s.amount??0).toString()),w(s.notes||""),L(!0),M(s),j(""),C(!0))},[h]),P=o.useCallback(()=>{C(!1),T(null),b(""),w(""),L(!1),M(null),j("")},[]),q=o.useCallback(async()=>{if(!r||!g)return;const s=parseFloat(g);if(isNaN(s)||s<=0){j("Please enter a valid payout amount."),N("Please enter a valid payout amount","error"),requestAnimationFrame(()=>f.current?.focus({preventScroll:!0}));return}if(s>p){j(`Amount cannot exceed ${l.format(p)}.`),N("Payout amount exceeds allowed amount","error"),requestAnimationFrame(()=>f.current?.focus({preventScroll:!0}));return}$(!0),setTimeout(()=>{if(u&&y){const a=y.amount,t=s-a;R(i=>i.map(n=>n.id===y.id?{...n,amount:s,notes:v||n.notes,processedAt:new Date().toLocaleString("en-PH",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",hour12:!0})+" (Edited)"}:n)),D(i=>i.map(n=>{if(n.id!==r.id)return n;const c=n.shortage-t,d=n.paidAmount+t,X=c<=0?"balanced":"needs_payout";return{...n,shortage:c,paidAmount:d,status:X,lastPayout:new Date().toLocaleString("en-PH",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",hour12:!0})}})),N(`Payout updated: ${l.format(s)} to ${r.name}`,"success")}else{const a={id:`PAY${Date.now().toString().slice(-6)}`,tellerId:r.id,tellerName:r.name,amount:s,type:"tapal",processedAt:new Date().toLocaleString("en-PH",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",hour12:!0}),processedBy:"Collector C001",notes:v||"Standard payout processing"};if(R(t=>[a,...t]),D(t=>t.map(i=>{if(i.id!==r.id)return i;const n=i.shortage-s,c=i.paidAmount+s,d=n<=0?"balanced":"needs_payout";return{...i,shortage:n,paidAmount:c,status:d,lastPayout:a.processedAt}})),s<r.shortage){const t=r.shortage-s;N(`Partial payout: ${l.format(s)} paid. Remaining shortage: ${l.format(t)}`,"success")}else N(`Full shortage covered: ${l.format(s)} to ${r.name}`,"success")}$(!1),P()},900)},[r,g,v,l,N,P,u,y,p]),G=s=>{const a={needs_payout:{class:"status-needs-payout",text:"NEEDS PAYOUT",icon:"💸"},surplus:{class:"status-surplus",text:"HAS SURPLUS",icon:"💰"},balanced:{class:"status-balanced",text:"BALANCED",icon:"✅"}};return a[s]||a.needs_payout},J=()=>e.jsxs("div",{className:"statistics-grid",children:[e.jsxs("div",{className:"stat-card",children:[e.jsx("div",{className:"stat-value",children:m.tellersNeedingPayout}),e.jsx("div",{className:"stat-label",children:"Need Payout"})]}),e.jsxs("div",{className:"stat-card shortage",children:[e.jsx("div",{className:"stat-value",children:l.format(m.totalShortage)}),e.jsx("div",{className:"stat-label",children:"Total Shortage"})]}),e.jsxs("div",{className:"stat-card surplus",children:[e.jsx("div",{className:"stat-value",children:l.format(m.totalSurplus)}),e.jsx("div",{className:"stat-label",children:"Total Surplus"})]}),e.jsxs("div",{className:"stat-card net",children:[e.jsx("div",{className:"stat-value",children:l.format(Math.abs(m.netPosition))}),e.jsx("div",{className:"stat-label",children:m.netPosition>=0?"Net Gain":"Net Loss"})]})]}),Q=({teller:s})=>{const a=G(s.status),t=s.status==="needs_payout"&&s.shortage>0,i=s.shortage>0,n=s.paidAmount>0&&s.shortage>0;return e.jsxs("article",{className:`teller-item ${s.status} ${i?"urgent":""}`,children:[e.jsxs("div",{className:"teller-header",children:[e.jsxs("div",{className:"teller-info",children:[e.jsx("div",{className:"teller-name",children:s.name}),e.jsxs("div",{className:"teller-meta",children:[e.jsx("span",{className:"teller-code",children:s.code}),e.jsx("span",{className:"teller-location",children:s.location})]})]}),e.jsxs("div",{className:`teller-status ${a.class}`,children:[e.jsx("span",{className:"status-icon",children:a.icon}),e.jsx("span",{className:"status-text",children:a.text})]})]}),e.jsxs("div",{className:"teller-stats",children:[e.jsxs("div",{className:"stat-row",children:[e.jsxs("div",{className:"stat",children:[e.jsx("div",{className:"stat-label",children:"Total Sales"}),e.jsx("div",{className:"stat-value",children:l.format(s.totalSales)})]}),e.jsxs("div",{className:"stat",children:[e.jsx("div",{className:"stat-label",children:"Winner Payouts"}),e.jsx("div",{className:"stat-value winners",children:l.format(s.totalWinners)})]})]}),e.jsxs("div",{className:"stat-row",children:[e.jsxs("div",{className:"stat",children:[e.jsx("div",{className:"stat-label",children:"Tickets Sold"}),e.jsx("div",{className:"stat-value",children:s.ticketsSold.toLocaleString()})]}),e.jsxs("div",{className:"stat",children:[e.jsx("div",{className:"stat-label",children:"Winning Tickets"}),e.jsx("div",{className:"stat-value winning-count",children:s.winningTickets.toLocaleString()})]})]}),s.paidAmount>0&&e.jsxs("div",{className:"payout-row paid-row",children:[e.jsx("div",{className:"payout-label",children:"Amount Paid"}),e.jsx("div",{className:"payout-amount paid",children:l.format(s.paidAmount)})]}),i&&e.jsxs("div",{className:"shortage-row",children:[e.jsx("div",{className:"shortage-label",children:n?"Remaining Shortage":"Shortage Amount"}),e.jsx("div",{className:"shortage-amount",children:l.format(s.shortage)})]}),s.surplus>0&&e.jsxs("div",{className:"surplus-row",children:[e.jsx("div",{className:"surplus-label",children:"Surplus Amount"}),e.jsx("div",{className:"surplus-amount",children:l.format(s.surplus)})]})]}),e.jsxs("div",{className:"teller-footer",children:[e.jsxs("div",{className:"last-payout",children:["Last Payout: ",s.lastPayout]}),t&&e.jsxs("button",{className:"btn btn-payout urgent",onClick:()=>O(s),children:[e.jsx("span",{className:"btn-icon",children:"💸"}),n?"Pay Remaining":"Process Tapal"]})]})]})},K=({payout:s})=>e.jsxs("article",{className:"history-item",children:[e.jsxs("div",{className:"history-header",children:[e.jsxs("div",{className:"history-info",children:[e.jsxs("div",{className:"history-id",children:["#",s.id]}),e.jsx("div",{className:"history-teller",children:s.tellerName}),e.jsx("div",{className:"history-type",children:s.type.toUpperCase()})]}),e.jsx("div",{className:"history-amount",children:l.format(s.amount)})]}),e.jsxs("div",{className:"history-details",children:[e.jsx("div",{className:"history-time",children:s.processedAt}),e.jsxs("div",{className:"history-processor",children:["by ",s.processedBy]})]}),s.reason&&e.jsxs("div",{className:"history-reason",children:["Reason: ",s.reason.replace(/_/g," ").toUpperCase()]}),s.notes&&e.jsx("div",{className:"history-notes",children:s.notes}),e.jsx("div",{className:"history-actions",children:e.jsxs("button",{className:"btn btn-edit",onClick:()=>Y(s),children:[e.jsx("span",{children:"✏️"}),"Edit Payout"]})})]}),V=({children:s})=>typeof document>"u"?null:ee.createPortal(s,document.body);return e.jsxs("div",{className:"container",children:[e.jsxs("header",{className:"header",children:[e.jsxs("div",{className:"header-content",children:[e.jsx("h1",{children:"Payout & Tapal"}),e.jsx("p",{className:"header-subtitle",children:"Process winner payouts or issue tapal for insufficient funds"})]}),e.jsxs(Z,{to:"/collector",className:"back-btn","aria-label":"Back to Dashboard",children:[e.jsx("span",{"aria-hidden":"true",children:"←"})," Back To Dashboard"]})]}),e.jsxs("section",{className:"card statistics-section",children:[e.jsxs("h2",{className:"section-title",children:[e.jsx("span",{className:"section-icon",children:"📊"}),"Payout Overview"]}),e.jsx(J,{}),e.jsxs("div",{className:"summary-details",children:[e.jsxs("div",{className:"summary-row",children:[e.jsx("span",{children:"Today's Payouts Issued"}),e.jsx("span",{className:"amount",children:l.format(m.totalPayoutsToday)})]}),e.jsxs("div",{className:"summary-row",children:[e.jsx("span",{children:"Net Company Position"}),e.jsxs("span",{className:`amount ${m.netPosition>=0?"positive":"negative"}`,children:[m.netPosition>=0?"+":"",l.format(m.netPosition)]})]})]})]}),e.jsxs("section",{className:"card controls-section",children:[e.jsxs("h2",{className:"section-title",children:[e.jsx("span",{className:"section-icon",children:"🔍"}),"Search & Filter"]}),e.jsxs("div",{className:"controls-grid",children:[e.jsxs("div",{className:"control-group",children:[e.jsx("label",{htmlFor:"search",className:"control-label",children:"Search Tellers"}),e.jsx("input",{id:"search",type:"text",className:"control-input",placeholder:"Search by name, code, or location...",value:A,onChange:s=>I(s.target.value)})]}),e.jsxs("div",{className:"control-group",children:[e.jsx("label",{htmlFor:"status-filter",className:"control-label",children:"Filter by Status"}),e.jsxs("select",{id:"status-filter",className:"control-select",value:S,onChange:s=>z(s.target.value),children:[e.jsx("option",{value:"all",children:"All Statuses"}),e.jsx("option",{value:"needs_payout",children:"Needs Payout"}),e.jsx("option",{value:"surplus",children:"Has Surplus"}),e.jsx("option",{value:"balanced",children:"Balanced"})]})]})]})]}),e.jsxs("section",{className:"card tellers-section",children:[e.jsxs("h2",{className:"section-title",children:[e.jsx("span",{className:"section-icon",children:"👥"}),"Tellers (",F.length,")"]}),F.length===0?e.jsxs("div",{className:"empty-state",children:[e.jsx("div",{className:"empty-icon",children:"🔍"}),e.jsx("div",{className:"empty-title",children:"No Tellers Found"}),e.jsx("div",{className:"empty-text",children:"Try adjusting your search criteria or filters."})]}):e.jsx("div",{className:"tellers-grid",children:F.map(s=>e.jsx(Q,{teller:s},s.id))})]}),e.jsxs("section",{className:"card history-section",children:[e.jsxs("h2",{className:"section-title",children:[e.jsx("span",{className:"section-icon",children:"📋"}),"Payout History"]}),B.length===0?e.jsxs("div",{className:"empty-state",children:[e.jsx("div",{className:"empty-icon",children:"📋"}),e.jsx("div",{className:"empty-title",children:"No Payouts Yet"}),e.jsx("div",{className:"empty-text",children:"Payout records will appear here after you process tapal payments."})]}):e.jsx("div",{className:"history-grid",children:B.map(s=>e.jsx(K,{payout:s},s.id))})]}),x&&r&&e.jsx(V,{children:e.jsx("div",{className:"modal-overlay",onClick:P,role:"dialog","aria-modal":"true","aria-labelledby":"payout-modal-title",children:e.jsxs("div",{className:"modal",onClick:s=>s.stopPropagation(),children:[e.jsxs("div",{className:"modal-header",children:[e.jsx("h3",{id:"payout-modal-title",children:u?"Edit Payout":"Process Payout"}),e.jsx("button",{className:"modal-close",onClick:P,"aria-label":"Close modal",children:"×"})]}),e.jsxs("div",{className:"modal-body",children:[e.jsxs("div",{className:"teller-summary",children:[e.jsxs("h4",{children:[r.name," (",r.code,")"]}),e.jsxs("div",{className:"summary-grid",children:[e.jsxs("div",{className:"summary-item",children:[e.jsx("span",{children:"Total Sales"}),e.jsx("span",{children:l.format(r.totalSales)})]}),e.jsxs("div",{className:"summary-item",children:[e.jsx("span",{children:"Winner Payouts"}),e.jsx("span",{children:l.format(r.totalWinners)})]}),r.paidAmount>0&&e.jsxs("div",{className:"summary-item",children:[e.jsx("span",{children:"Already Paid"}),e.jsx("span",{className:"paid-highlight",children:l.format(r.paidAmount)})]}),e.jsxs("div",{className:"summary-item shortage-highlight",children:[e.jsx("span",{children:u?"Current Shortage":r.paidAmount>0?"Remaining Shortage":"Shortage Amount"}),e.jsx("span",{className:"highlight",children:l.format(r.shortage)})]})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"payout-amount",className:"form-label",children:"Payout Amount"}),e.jsx("input",{id:"payout-amount",ref:f,type:"text",inputMode:"decimal",pattern:"[0-9]*[.,]?[0-9]{0,2}",className:"form-input",value:g,onChange:U,onWheel:s=>{s.preventDefault(),s.stopPropagation()},onKeyDown:s=>{(s.key==="ArrowUp"||s.key==="ArrowDown")&&s.preventDefault()},"aria-describedby":"payout-amount-help",placeholder:`Max ${l.format(p)}`,autoFocus:!0}),e.jsx("div",{id:"payout-amount-help",className:"form-help",children:_?e.jsx("span",{style:{color:"#ef4444"},children:_}):u?`You can update up to ${l.format(p)}.`:`Enter amount up to ${l.format(p)}.`})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"payout-notes",className:"form-label",children:"Notes (Optional)"}),e.jsx("textarea",{id:"payout-notes",className:"form-textarea",placeholder:"Add any notes about this payout...",value:v,onChange:s=>w(s.target.value),maxLength:500}),e.jsxs("div",{className:"form-help",children:[v.length,"/500 characters"]})]})]}),e.jsxs("div",{className:"modal-footer",children:[e.jsx("button",{className:"btn btn-secondary",onClick:P,disabled:k,children:"Cancel"}),e.jsx("button",{className:"btn btn-primary",onClick:q,disabled:k||!g,children:k?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"spinner"}),"Processing..."]}):e.jsxs(e.Fragment,{children:[e.jsx("span",{children:u?"✏️":"💸"}),u?"Update Payout":"Process Payout"]})})]})]})})}),E.show&&e.jsx("div",{className:`toast show ${E.type}`,children:E.message})]})};export{ne as default};
